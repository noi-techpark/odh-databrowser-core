/*!
*  angular-leaflet-directive  2015-11-06
*  angular-leaflet-directive - An AngularJS directive to easily interact with Leaflet maps
*  git: https://github.com/tombatossals/angular-leaflet-directive
*/
(function(n){"use strict";!function(n){n.module("leaflet-directive",[]).directive("leaflet",["$q","leafletData","leafletMapDefaults","leafletHelpers","leafletMapEvents",function(n,t,i,r,u){return{restrict:"EA",replace:!0,scope:{center:"=",lfCenter:"=",defaults:"=",maxbounds:"=",bounds:"=",markers:"=",legend:"=",geojson:"=",paths:"=",tiles:"=",layers:"=",controls:"=",decorations:"=",eventBroadcast:"=",markersWatchOptions:"=",geojsonWatchOptions:"="},transclude:!0,template:'<div class="angular-leaflet-map"><div ng-transclude><\/div><\/div>',controller:["$scope",function(t){this._leafletMap=n.defer();this.getMap=function(){return this._leafletMap.promise};this.getLeafletScope=function(){return t}}],link:function(n,f,e,o){function a(){isNaN(e.width)?f.css("width",e.width):f.css("width",e.width+"px")}function v(){isNaN(e.height)?f.css("height",e.height):f.css("height",e.height+"px")}var h=r.isDefined,c=i.setDefaults(n.defaults,e.id),p=u.getAvailableMapEvents(),w=u.addEvents,s,l,y;n.mapId=e.id;t.setDirectiveControls({},e.id);h(e.width)&&(a(),n.$watch(function(){return f[0].getAttribute("width")},function(){a();s.invalidateSize()}));h(e.height)&&(v(),n.$watch(function(){return f[0].getAttribute("height")},function(){v();s.invalidateSize()}));s=new L.Map(f[0],i.getMapCreationDefaults(e.id));(o._leafletMap.resolve(s),h(e.center)||h(e.lfCenter)||s.setView([c.center.lat,c.center.lng],c.center.zoom),h(e.tiles)||h(e.layers))||(l=L.tileLayer(c.tileLayer,c.tileLayerOptions),l.addTo(s),t.setTiles(l,e.id));(h(s.zoomControl)&&h(c.zoomControlPosition)&&s.zoomControl.setPosition(c.zoomControlPosition),h(s.zoomControl)&&c.zoomControl===!1&&s.zoomControl.removeFrom(s),h(s.zoomsliderControl)&&h(c.zoomsliderControl)&&c.zoomsliderControl===!1&&s.zoomsliderControl.removeFrom(s),h(e.eventBroadcast))||(y="broadcast",w(s,p,"eventName",n,y));s.whenReady(function(){t.setMap(s,e.id)});n.$on("$destroy",function(){i.reset();s.remove();t.unresolveMap(e.id)});n.$on("invalidateSize",function(){s.invalidateSize()})}}}]);n.module("leaflet-directive").factory("leafletBoundsHelpers",["$log","leafletHelpers",function(t,i){function f(t){return n.isDefined(t)&&n.isDefined(t.southWest)&&n.isDefined(t.northEast)&&n.isNumber(t.southWest.lat)&&n.isNumber(t.southWest.lng)&&n.isNumber(t.northEast.lat)&&n.isNumber(t.northEast.lng)}var u=i.isArray,r=i.isNumber,e=i.isFunction,o=i.isDefined;return{createLeafletBounds:function(n){if(f(n))return L.latLngBounds([n.southWest.lat,n.southWest.lng],[n.northEast.lat,n.northEast.lng])},isValidBounds:f,createBoundsFromArray:function(n){return u(n)&&2===n.length&&u(n[0])&&u(n[1])&&2===n[0].length&&2===n[1].length&&r(n[0][0])&&r(n[0][1])&&r(n[1][0])&&r(n[1][1])?{northEast:{lat:n[0][0],lng:n[0][1]},southWest:{lat:n[1][0],lng:n[1][1]}}:void t.error("[AngularJS - Leaflet] The bounds array is not valid.")},createBoundsFromLeaflet:function(n){if(!(o(n)&&e(n.getNorthEast)&&e(n.getSouthWest)))return void t.error("[AngularJS - Leaflet] The leaflet bounds is not valid object.");var i=n.getNorthEast(),r=n.getSouthWest();return{northEast:{lat:i.lat,lng:i.lng},southWest:{lat:r.lat,lng:r.lng}}}}}]);n.module("leaflet-directive").factory("leafletControlHelpers",["$rootScope","$log","leafletHelpers","leafletLayerHelpers","leafletMapDefaults",function(t,i,r,u,f){var e=r.isDefined,c=r.isObject,a=u.createLayer,s={},o=r.errorHeader+" [Controls] ",l=function(n,t,i){var u=f.getDefaults(i),r;return u.controls.layers.visible?(r=!1,c(n)&&Object.keys(n).forEach(function(t){var i=n[t];e(i.layerOptions)&&i.layerOptions.showOnSelector===!1||(r=!0)}),c(t)&&Object.keys(t).forEach(function(n){var i=t[n];e(i.layerParams)&&i.layerParams.showOnSelector===!1||(r=!0)}),r):!1},v=function(t){var i=f.getDefaults(t),r={collapsed:i.controls.layers.collapsed,position:i.controls.layers.position,autoZIndex:!1};return n.extend(r,i.controls.layers.options),i.controls.layers&&e(i.controls.layers.control)?i.controls.layers.control.apply(this,[[],[],r]):new L.control.layers([],[],r)},h={draw:{isPluginLoaded:function(){return n.isDefined(L.Control.Draw)?!0:(i.error(o+" Draw plugin is not loaded."),!1)},checkValidParams:function(){return!0},createControl:function(n){return new L.Control.Draw(n)}},scale:{isPluginLoaded:function(){return!0},checkValidParams:function(){return!0},createControl:function(n){return new L.control.scale(n)}},fullscreen:{isPluginLoaded:function(){return n.isDefined(L.Control.Fullscreen)?!0:(i.error(o+" Fullscreen plugin is not loaded."),!1)},checkValidParams:function(){return!0},createControl:function(n){return new L.Control.Fullscreen(n)}},search:{isPluginLoaded:function(){return n.isDefined(L.Control.Search)?!0:(i.error(o+" Search plugin is not loaded."),!1)},checkValidParams:function(){return!0},createControl:function(n){return new L.Control.Search(n)}},custom:{},minimap:{isPluginLoaded:function(){return n.isDefined(L.Control.MiniMap)?!0:(i.error(o+" Minimap plugin is not loaded."),!1)},checkValidParams:function(n){return e(n.layer)?!0:(i.warn(o+' minimap "layer" option should be defined.'),!1)},createControl:function(n){var t=a(n.layer);return e(t)?new L.Control.MiniMap(t,n):void i.warn(o+' minimap control "layer" could not be created.')}}};return{layersControlMustBeVisible:l,isValidControlType:function(n){return-1!==Object.keys(h).indexOf(n)},createControl:function(n,t){if(h[n].checkValidParams(t))return h[n].createControl(t)},updateLayersControl:function(n,t,i,r,u,f){var o,h=s[t],c=l(r,u,t),a,y;if(e(h)&&i){for(o in f.baselayers)h.removeLayer(f.baselayers[o]);for(o in f.overlays)h.removeLayer(f.overlays[o]);n.removeControl(h);delete s[t]}if(c){h=v(t);s[t]=h;for(o in r)a=e(r[o].layerOptions)&&r[o].layerOptions.showOnSelector===!1,!a&&e(f.baselayers[o])&&h.addBaseLayer(f.baselayers[o],r[o].name);for(o in u)y=e(u[o].layerParams)&&u[o].layerParams.showOnSelector===!1,!y&&e(f.overlays[o])&&h.addOverlay(f.overlays[o],u[o].name);n.addControl(h)}return c}}}]);n.module("leaflet-directive").service("leafletData",["$log","$q","leafletHelpers",function(n,t,i){var e=i.getDefer,o=i.getUnresolvedDefer,s=i.setResolvedDefer,r={},f=this,h=function(n){return n.charAt(0).toUpperCase()+n.slice(1)},u=["map","tiles","layers","paths","markers","geoJSON","UTFGrid","decorations","directiveControls"];u.forEach(function(n){r[n]={}});this.unresolveMap=function(n){var t=i.obtainEffectiveMapId(r.map,n);u.forEach(function(n){r[n][t]=void 0})};u.forEach(function(n){var t=h(n);f["set"+t]=function(t,i){var u=o(r[n],i);u.resolve(t);s(r[n],i)};f["get"+t]=function(t){var i=e(r[n],t);return i.promise}})}]);n.module("leaflet-directive").service("leafletDirectiveControlsHelpers",["$log","leafletData","leafletHelpers",function(t,i,r){var u=r.isDefined,f=r.isString,e=r.isObject,o=r.errorHeader,s=o+"[leafletDirectiveControlsHelpers",h=function(r,o,h,c){var a=s+".extend] ",l={};if(!u(o))return void t.error(a+"thingToAddName cannot be undefined");if(f(o)&&u(h)&&u(c))l[o]={create:h,clean:c};else{if(!e(o)||u(h)||u(c))return void t.error(a+"incorrect arguments");l=o}i.getDirectiveControls().then(function(t){n.extend(t,l);i.setDirectiveControls(t,r)})};return{extend:h}}]);n.module("leaflet-directive").service("leafletGeoJsonHelpers",["leafletHelpers","leafletIterators",function(t,i){var r=t,e=i,u=function(n,t){return this.lat=n,this.lng=t,this},o=function(n){return Array.isArray(n)&&2===n.length?n[1]:r.isDefined(n.type)&&"Point"===n.type?+n.coordinates[1]:+n.lat},s=function(n){return Array.isArray(n)&&2===n.length?n[0]:r.isDefined(n.type)&&"Point"===n.type?+n.coordinates[0]:+n.lng},f=function(n){if(r.isUndefined(n))return!1;if(r.isArray(n)){if(2===n.length&&r.isNumber(n[0])&&r.isNumber(n[1]))return!0}else if(r.isDefined(n.type)&&"Point"===n.type&&r.isArray(n.coordinates)&&2===n.coordinates.length&&r.isNumber(n.coordinates[0])&&r.isNumber(n.coordinates[1]))return!0;return e.all(["lat","lng"],function(t){return r.isDefined(n[t])&&r.isNumber(n[t])})},h=function(t){if(t&&f(t)){var i=null;if(Array.isArray(t)&&2===t.length)i=new u(t[1],t[0]);else{if(!r.isDefined(t.type)||"Point"!==t.type)return t;i=new u(t.coordinates[1],t.coordinates[0])}return n.extend(t,i)}};return{getLat:o,getLng:s,validateCoords:f,getCoords:h}}]);n.module("leaflet-directive").service("leafletHelpers",["$q","$log",function(t,i){function r(t,r){var u,f;if(n.isDefined(r))u=r;else if(0===Object.keys(t).length)u="main";else if(Object.keys(t).length>=1)for(f in t)t.hasOwnProperty(f)&&(u=f);else i.error(e+"- You have more than 1 map on the DOM, you must provide the map ID to the leafletData.getXXX call");return u}function f(i,u){var f,e=r(i,u);return n.isDefined(i[e])&&i[e].resolvedDefer!==!0?f=i[e].defer:(f=t.defer(),i[e]={defer:f,resolvedDefer:!1}),f}var e="[AngularJS - Leaflet] ",o=n.copy,h=o,c=function(t,i){var r;if(t&&n.isObject(t))return null!==i&&n.isString(i)?(r=t,i.split(".").forEach(function(n){r&&(r=r[n])}),r):i},l=function(n){return n.split(".").reduce(function(n,t){return n+'["'+t+'"]'})},a=function(n){return n.reduce(function(n,t){return n+"."+t})},u=function(t){return n.isDefined(t)&&null!==t},v=function(n){return!u(n)},y=/([\:\-\_]+(.))/g,p=/^moz([A-Z])/,w=/^((?:x|data)[\:\-_])/i,s=function(n){return n.replace(y,function(n,t,i,r){return r?i.toUpperCase():i}).replace(p,"Moz$1")},b=function(n){return s(n.replace(w,""))};return{camelCase:s,directiveNormalize:b,copy:o,clone:h,errorHeader:e,getObjectValue:c,getObjectArrayPath:l,getObjectDotPath:a,defaultTo:function(n,t){return u(n)?n:t},isTruthy:function(n){return"true"===n||n===!0},isEmpty:function(n){return 0===Object.keys(n).length},isUndefinedOrEmpty:function(t){return n.isUndefined(t)||null===t||0===Object.keys(t).length},isDefined:u,isUndefined:v,isNumber:n.isNumber,isString:n.isString,isArray:n.isArray,isObject:n.isObject,isFunction:n.isFunction,equals:n.equals,isValidCenter:function(t){return n.isDefined(t)&&n.isNumber(t.lat)&&n.isNumber(t.lng)&&n.isNumber(t.zoom)},isValidPoint:function(t){return n.isDefined(t)?n.isArray(t)?2===t.length&&n.isNumber(t[0])&&n.isNumber(t[1]):n.isNumber(t.lat)&&n.isNumber(t.lng):!1},isSameCenterOnMap:function(n,t){var i=t.getCenter(),r=t.getZoom();return n.lat&&n.lng&&i.lat.toFixed(4)===n.lat.toFixed(4)&&i.lng.toFixed(4)===n.lng.toFixed(4)&&r===n.zoom?!0:!1},safeApply:function(n,t){var i=n.$root.$$phase;"$apply"===i||"$digest"===i?n.$eval(t):n.$evalAsync(t)},obtainEffectiveMapId:r,getDefer:function(t,i){var u=r(t,i);return n.isDefined(t[u])&&t[u].resolvedDefer!==!1?t[u].defer:f(t,i)},getUnresolvedDefer:f,setResolvedDefer:function(n,t){var i=r(n,t);n[i].resolvedDefer=!0},rangeIsSupported:function(){var n=document.createElement("input");return n.setAttribute("type","range"),"range"===n.type},FullScreenControlPlugin:{isLoaded:function(){return n.isDefined(L.Control.Fullscreen)}},MiniMapControlPlugin:{isLoaded:function(){return n.isDefined(L.Control.MiniMap)}},AwesomeMarkersPlugin:{isLoaded:function(){return n.isDefined(L.AwesomeMarkers)&&n.isDefined(L.AwesomeMarkers.Icon)},is:function(n){return this.isLoaded()?n instanceof L.AwesomeMarkers.Icon:!1},equal:function(t,i){return this.isLoaded()&&this.is(t)?n.equals(t,i):!1}},VectorMarkersPlugin:{isLoaded:function(){return n.isDefined(L.VectorMarkers)&&n.isDefined(L.VectorMarkers.Icon)},is:function(n){return this.isLoaded()?n instanceof L.VectorMarkers.Icon:!1},equal:function(t,i){return this.isLoaded()&&this.is(t)?n.equals(t,i):!1}},DomMarkersPlugin:{isLoaded:function(){return n.isDefined(L.DomMarkers)&&n.isDefined(L.DomMarkers.Icon)?!0:!1},is:function(n){return this.isLoaded()?n instanceof L.DomMarkers.Icon:!1},equal:function(t,i){return this.isLoaded()&&this.is(t)?n.equals(t,i):!1}},PolylineDecoratorPlugin:{isLoaded:function(){return n.isDefined(L.PolylineDecorator)?!0:!1},is:function(n){return this.isLoaded()?n instanceof L.PolylineDecorator:!1},equal:function(t,i){return this.isLoaded()&&this.is(t)?n.equals(t,i):!1}},MakiMarkersPlugin:{isLoaded:function(){return n.isDefined(L.MakiMarkers)&&n.isDefined(L.MakiMarkers.Icon)?!0:!1},is:function(n){return this.isLoaded()?n instanceof L.MakiMarkers.Icon:!1},equal:function(t,i){return this.isLoaded()&&this.is(t)?n.equals(t,i):!1}},ExtraMarkersPlugin:{isLoaded:function(){return n.isDefined(L.ExtraMarkers)&&n.isDefined(L.ExtraMarkers.Icon)?!0:!1},is:function(n){return this.isLoaded()?n instanceof L.ExtraMarkers.Icon:!1},equal:function(t,i){return this.isLoaded()&&this.is(t)?n.equals(t,i):!1}},LabelPlugin:{isLoaded:function(){return n.isDefined(L.Label)},is:function(n){return this.isLoaded()?n instanceof L.MarkerClusterGroup:!1}},MarkerClusterPlugin:{isLoaded:function(){return n.isDefined(L.MarkerClusterGroup)},is:function(n){return this.isLoaded()?n instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return n.isDefined(L.Google)},is:function(n){return this.isLoaded()?n instanceof L.Google:!1}},LeafletProviderPlugin:{isLoaded:function(){return n.isDefined(L.TileLayer.Provider)},is:function(n){return this.isLoaded()?n instanceof L.TileLayer.Provider:!1}},ChinaLayerPlugin:{isLoaded:function(){return n.isDefined(L.tileLayer.chinaProvider)}},HeatLayerPlugin:{isLoaded:function(){return n.isDefined(L.heatLayer)}},WebGLHeatMapLayerPlugin:{isLoaded:function(){return n.isDefined(L.TileLayer.WebGLHeatMap)}},BingLayerPlugin:{isLoaded:function(){return n.isDefined(L.BingLayer)},is:function(n){return this.isLoaded()?n instanceof L.BingLayer:!1}},WFSLayerPlugin:{isLoaded:function(){return void 0!==L.GeoJSON.WFS},is:function(n){return this.isLoaded()?n instanceof L.GeoJSON.WFS:!1}},AGSBaseLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.basemapLayer},is:function(n){return this.isLoaded()?n instanceof L.esri.basemapLayer:!1}},AGSLayerPlugin:{isLoaded:function(){return void 0!==lvector&&void 0!==lvector.AGS},is:function(n){return this.isLoaded()?n instanceof lvector.AGS:!1}},AGSFeatureLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.featureLayer},is:function(n){return this.isLoaded()?n instanceof L.esri.featureLayer:!1}},AGSTiledMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.tiledMapLayer},is:function(n){return this.isLoaded()?n instanceof L.esri.tiledMapLayer:!1}},AGSDynamicMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.dynamicMapLayer},is:function(n){return this.isLoaded()?n instanceof L.esri.dynamicMapLayer:!1}},AGSImageMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.imageMapLayer},is:function(n){return this.isLoaded()?n instanceof L.esri.imageMapLayer:!1}},AGSClusteredLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.clusteredFeatureLayer},is:function(n){return this.isLoaded()?n instanceof L.esri.clusteredFeatureLayer:!1}},AGSHeatmapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.heatmapFeatureLayer},is:function(n){return this.isLoaded()?n instanceof L.esri.heatmapFeatureLayer:!1}},YandexLayerPlugin:{isLoaded:function(){return n.isDefined(L.Yandex)},is:function(n){return this.isLoaded()?n instanceof L.Yandex:!1}},GeoJSONPlugin:{isLoaded:function(){return n.isDefined(L.TileLayer.GeoJSON)},is:function(n){return this.isLoaded()?n instanceof L.TileLayer.GeoJSON:!1}},UTFGridPlugin:{isLoaded:function(){return n.isDefined(L.UtfGrid)},is:function(n){return this.isLoaded()?n instanceof L.UtfGrid:(i.error("[AngularJS - Leaflet] No UtfGrid plugin found."),!1)}},CartoDB:{isLoaded:function(){return cartodb},is:function(){return!0}},Leaflet:{DivIcon:{is:function(n){return n instanceof L.DivIcon},equal:function(t,i){return this.is(t)?n.equals(t,i):!1}},Icon:{is:function(n){return n instanceof L.Icon},equal:function(t,i){return this.is(t)?n.equals(t,i):!1}}},watchOptions:{doWatch:!0,isDeep:!0,individual:{doWatch:!0,isDeep:!0}}}}]);n.module("leaflet-directive").service("leafletIterators",["$log","leafletHelpers",function(n,t){var f,i=t,v=t.errorHeader+"leafletIterators: ",r=Object.keys,y=i.isFunction,p=i.isObject,w=Math.pow(2,53)-1,b=function(n){var t=null!==n&&n.length;return i.isNumber(t)&&t>=0&&w>=t},k=function(n){return n},d=function(n){return function(t){if(null!==t)return t[n]}},g=function(n,t,i){if(void 0===t)return n;switch(null===i?3:i){case 1:return function(i){return n.call(t,i)};case 2:return function(i,r){return n.call(t,i,r)};case 3:return function(i,r,u){return n.call(t,i,r,u)};case 4:return function(i,r,u,f){return n.call(t,i,r,u,f)}}return function(){return n.apply(t,arguments)}},nt=function(n,t){return function(i){var e=arguments.length,r,u;if(2>e||null===i)return i;for(r=1;e>r;r++)for(var o=arguments[r],s=n(o),h=s.length,f=0;h>f;f++)u=s[f],t&&void 0!==i[u]||(i[u]=o[u]);return i}},tt=null,e,o,s,h,c,u;f=tt=nt(r);o=function(n,t){var e=r(t),o=e.length,f,i,u;if(null===n)return!o;for(f=Object(n),i=0;o>i;i++)if(u=e[i],t[u]!==f[u]||!(u in f))return!1;return!0};s=null;e=s=function(n){return n=f({},n),function(t){return o(t,n)}};c=function(n,t,i){return null===n?k:y(n)?g(n,t,i):p(n)?e(n):d(n)};u=null;h=u=function(n,t,i){var e;t=c(t,i);for(var f=!b(n)&&r(n),o=(f||n).length,u=0;o>u;u++)if(e=f?f[u]:u,!t(n[e],e,n))return!1;return!0};var l=function(t,r,u,f){return u||i.isDefined(t)&&i.isDefined(r)?i.isFunction(r)?!1:(f=i.defaultTo(r,"cb"),n.error(v+f+" is not a function"),!0):!0},it=function(n,t,i){if(!l(void 0,i,!0,"internalCb")&&!l(n,t))for(var r in n)n.hasOwnProperty(r)&&i(n[r],r)},a=function(n,t){it(n,t,function(n,i){t(n,i)})};return{each:a,forEach:a,every:h,all:u}}]);n.module("leaflet-directive").factory("leafletLayerHelpers",["$rootScope","$log","$q","leafletHelpers","leafletIterators",function(t,i,r,u,f){function y(n){return c(n.type)?-1===Object.keys(h).indexOf(n.type)?(i.error("[AngularJS - Leaflet] A layer must have a valid type: "+Object.keys(h)),!1):h[n.type].mustHaveUrl&&!c(n.url)?(i.error("[AngularJS - Leaflet] A base layer must have an url"),!1):h[n.type].mustHaveData&&!o(n.data)?(i.error('[AngularJS - Leaflet] The base layer must have a "data" array attribute'),!1):h[n.type].mustHaveLayer&&!o(n.layer)?(i.error("[AngularJS - Leaflet] The type of layer "+n.type+" must have an layer defined"),!1):h[n.type].mustHaveBounds&&!o(n.bounds)?(i.error("[AngularJS - Leaflet] The type of layer "+n.type+" must have bounds defined"),!1):h[n.type].mustHaveKey&&!o(n.key)?(i.error("[AngularJS - Leaflet] The type of layer "+n.type+" must have key defined"),!1):!0:(i.error("[AngularJS - Leaflet] A layer must have a valid type defined."),!1)}function v(n){var t,r;if(y(n)){if(!c(n.name))return void i.error("[AngularJS - Leaflet] A base layer must have a name");l(n.layerParams)||(n.layerParams={});l(n.layerOptions)||(n.layerOptions={});for(t in n.layerParams)n.layerOptions[t]=n.layerParams[t];return r={url:n.url,data:n.data,options:n.layerOptions,layer:n.layer,icon:n.icon,type:n.layerType,bounds:n.bounds,key:n.key,apiKey:n.apiKey,pluginOptions:n.pluginOptions,user:n.user},h[n.type].createLayer(r)}}function p(n,t){t&&"function"==typeof t.addTo?t.addTo(n):n.addLayer(t)}function w(t,r,u){var f,e,h,s;if(o(u)&&o(u.loadedDefer))if(n.isFunction(u.loadedDefer))if(f=u.loadedDefer(),i.debug("Loaded Deferred",f),e=f.length,e>0)for(h=function(){e--;0===e&&t.removeLayer(r)},s=0;s<f.length;s++)f[s].promise.then(h);else t.removeLayer(r);else u.loadedDefer.promise.then(function(){t.removeLayer(r)});else t.removeLayer(r)}var e=u,c=u.isString,l=u.isObject,b=u.isArray,o=u.isDefined,s=u.errorHeader,k=f,a=function(n){if(!e.UTFGridPlugin.isLoaded())return void i.error("[AngularJS - Leaflet] The UTFGrid plugin is not loaded.");var r=new L.UtfGrid(n.url,n.pluginOptions);return r.on("mouseover",function(n){t.$broadcast("leafletDirectiveMap.utfgridMouseover",n)}),r.on("mouseout",function(n){t.$broadcast("leafletDirectiveMap.utfgridMouseout",n)}),r.on("click",function(n){t.$broadcast("leafletDirectiveMap.utfgridClick",n)}),r.on("mousemove",function(n){t.$broadcast("leafletDirectiveMap.utfgridMousemove",n)}),r},h={xyz:{mustHaveUrl:!0,createLayer:function(n){return L.tileLayer(n.url,n.options)}},mapbox:{mustHaveKey:!0,createLayer:function(n){var t=3,i;return o(n.options.version)&&4===n.options.version&&(t=n.options.version),i=3===t?"//{s}.tiles.mapbox.com/v3/"+n.key+"/{z}/{x}/{y}.png":"//api.tiles.mapbox.com/v4/"+n.key+"/{z}/{x}/{y}.png?access_token="+n.apiKey,L.tileLayer(i,n.options)}},geoJSON:{mustHaveUrl:!0,createLayer:function(n){if(e.GeoJSONPlugin.isLoaded())return new L.TileLayer.GeoJSON(n.url,n.pluginOptions,n.options)}},geoJSONShape:{mustHaveUrl:!1,createLayer:function(n){return new L.GeoJSON(n.data,n.options)}},geoJSONAwesomeMarker:{mustHaveUrl:!1,createLayer:function(n){return new L.geoJson(n.data,{pointToLayer:function(t,i){return L.marker(i,{icon:L.AwesomeMarkers.icon(n.icon)})}})}},geoJSONVectorMarker:{mustHaveUrl:!1,createLayer:function(n){return new L.geoJson(n.data,{pointToLayer:function(t,i){return L.marker(i,{icon:L.VectorMarkers.icon(n.icon)})}})}},utfGrid:{mustHaveUrl:!0,createLayer:a},cartodbTiles:{mustHaveKey:!0,createLayer:function(n){var t="//"+n.user+".cartodb.com/api/v1/map/"+n.key+"/{z}/{x}/{y}.png";return L.tileLayer(t,n.options)}},cartodbUTFGrid:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(n){return n.url="//"+n.user+".cartodb.com/api/v1/map/"+n.key+"/"+n.layer+"/{z}/{x}/{y}.grid.json",a(n)}},cartodbInteractive:{mustHaveKey:!0,mustHaveLayer:!0,createLayer:function(n){var i="//"+n.user+".cartodb.com/api/v1/map/"+n.key+"/{z}/{x}/{y}.png",r=L.tileLayer(i,n.options),t;return n.url="//"+n.user+".cartodb.com/api/v1/map/"+n.key+"/"+n.layer+"/{z}/{x}/{y}.grid.json",t=a(n),L.layerGroup([r,t])}},wms:{mustHaveUrl:!0,createLayer:function(n){return L.tileLayer.wms(n.url,n.options)}},wmts:{mustHaveUrl:!0,createLayer:function(n){return L.tileLayer.wmts(n.url,n.options)}},wfs:{mustHaveUrl:!0,mustHaveLayer:!0,createLayer:function(t){if(e.WFSLayerPlugin.isLoaded()){var i=n.copy(t.options);return i.crs&&"string"==typeof i.crs&&(i.crs=eval(i.crs)),new L.GeoJSON.WFS(t.url,t.layer,i)}}},group:{mustHaveUrl:!1,createLayer:function(n){var t=[];return k.each(n.options.layers,function(n){t.push(v(n))}),n.options.loadedDefer=function(){var r=[],t,i;if(o(n.options.layers))for(t=0;t<n.options.layers.length;t++)i=n.options.layers[t].layerOptions.loadedDefer,o(i)&&r.push(i);return r},L.layerGroup(t)}},featureGroup:{mustHaveUrl:!1,createLayer:function(){return L.featureGroup()}},google:{mustHaveUrl:!1,createLayer:function(n){var t=n.type||"SATELLITE";if(e.GoogleLayerPlugin.isLoaded())return new L.Google(t,n.options)}},here:{mustHaveUrl:!1,createLayer:function(n){var t=n.provider||"HERE.terrainDay";if(e.LeafletProviderPlugin.isLoaded())return new L.TileLayer.Provider(t,n.options)}},china:{mustHaveUrl:!1,createLayer:function(n){var t=n.type||"";if(e.ChinaLayerPlugin.isLoaded())return L.tileLayer.chinaProvider(t,n.options)}},agsBase:{mustHaveLayer:!0,createLayer:function(n){if(e.AGSBaseLayerPlugin.isLoaded())return L.esri.basemapLayer(n.layer,n.options)}},ags:{mustHaveUrl:!0,createLayer:function(t){var r,i;if(e.AGSLayerPlugin.isLoaded())return r=n.copy(t.options),n.extend(r,{url:t.url}),i=new lvector.AGS(r),i.onAdd=function(n){this.setMap(n)},i.onRemove=function(){this.setMap(null)},i}},agsFeature:{mustHaveUrl:!0,createLayer:function(n){if(!e.AGSFeatureLayerPlugin.isLoaded())return void i.warn(s+" The esri plugin is not loaded.");n.options.url=n.url;var t=L.esri.featureLayer(n.options),u=function(){o(n.options.loadedDefer)&&n.options.loadedDefer.resolve()};return t.on("loading",function(){n.options.loadedDefer=r.defer();t.off("load",u);t.on("load",u)}),t}},agsTiled:{mustHaveUrl:!0,createLayer:function(n){return e.AGSTiledMapLayerPlugin.isLoaded()?(n.options.url=n.url,L.esri.tiledMapLayer(n.options)):void i.warn(s+" The esri plugin is not loaded.")}},agsDynamic:{mustHaveUrl:!0,createLayer:function(n){return e.AGSDynamicMapLayerPlugin.isLoaded()?(n.options.url=n.url,L.esri.dynamicMapLayer(n.options)):void i.warn(s+" The esri plugin is not loaded.")}},agsImage:{mustHaveUrl:!0,createLayer:function(n){return e.AGSImageMapLayerPlugin.isLoaded()?(n.options.url=n.url,L.esri.imageMapLayer(n.options)):void i.warn(s+" The esri plugin is not loaded.")}},agsClustered:{mustHaveUrl:!0,createLayer:function(n){return e.AGSClusteredLayerPlugin.isLoaded()?e.MarkerClusterPlugin.isLoaded()?L.esri.clusteredFeatureLayer(n.url,n.options):void i.warn(s+" The markercluster plugin is not loaded."):void i.warn(s+" The esri clustered layer plugin is not loaded.")}},agsHeatmap:{mustHaveUrl:!0,createLayer:function(n){return e.AGSHeatmapLayerPlugin.isLoaded()?e.HeatLayerPlugin.isLoaded()?L.esri.heatmapFeatureLayer(n.url,n.options):void i.warn(s+" The heatlayer plugin is not loaded."):void i.warn(s+" The esri heatmap layer plugin is not loaded.")}},markercluster:{mustHaveUrl:!1,createLayer:function(n){return e.MarkerClusterPlugin.isLoaded()?new L.MarkerClusterGroup(n.options):void i.warn(s+" The markercluster plugin is not loaded.")}},bing:{mustHaveUrl:!1,createLayer:function(n){if(e.BingLayerPlugin.isLoaded())return new L.BingLayer(n.key,n.options)}},webGLHeatmap:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(n){if(e.WebGLHeatMapLayerPlugin.isLoaded()){var t=new L.TileLayer.WebGLHeatMap(n.options);return o(n.data)&&t.setData(n.data),t}}},heat:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(n){if(e.HeatLayerPlugin.isLoaded()){var t=new L.heatLayer;return b(n.data)&&t.setLatLngs(n.data),l(n.options)&&t.setOptions(n.options),t}}},yandex:{mustHaveUrl:!1,createLayer:function(n){var t=n.type||"map";if(e.YandexLayerPlugin.isLoaded())return new L.Yandex(t,n.options)}},imageOverlay:{mustHaveUrl:!0,mustHaveBounds:!0,createLayer:function(n){return L.imageOverlay(n.url,n.bounds,n.options)}},iip:{mustHaveUrl:!0,createLayer:function(n){return L.tileLayer.iip(n.url,n.options)}},custom:{createLayer:function(t){return t.layer instanceof L.Class?n.copy(t.layer):void i.error("[AngularJS - Leaflet] A custom layer must be a leaflet Class")}},cartodb:{mustHaveUrl:!0,createLayer:function(n){return cartodb.createLayer(n.map,n.url)}}};return{createLayer:v,safeAddLayer:p,safeRemoveLayer:w}}]);n.module("leaflet-directive").factory("leafletLegendHelpers",function(){var n=function(n,t,i,r){var f,u,e,o;if(n.innerHTML="",t.error)n.innerHTML+='<div class="info-title alert alert-danger">'+t.error.message+"<\/div>";else if("arcgis"===i)for(f=0;f<t.layers.length;f++)for(u=t.layers[f],n.innerHTML+='<div class="info-title" data-layerid="'+u.layerId+'">'+u.layerName+"<\/div>",e=0;e<u.legend.length;e++)o=u.legend[e],n.innerHTML+='<div class="inline" data-layerid="'+u.layerId+'"><img src="data:'+o.contentType+";base64,"+o.imageData+'" /><\/div><div class="info-label" data-layerid="'+u.layerId+'">'+o.label+"<\/div>";else"image"===i&&(n.innerHTML='<img src="'+r+'"/>')},t=function(t,i,r,u){return function(){var f=L.DomUtil.create("div",i);return L.Browser.touch?L.DomEvent.on(f,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(f),L.DomEvent.on(f,"mousewheel",L.DomEvent.stopPropagation)),n(f,t,r,u),f}},i=function(n,t){return function(){for(var i=L.DomUtil.create("div",t),r=0;r<n.colors.length;r++)i.innerHTML+='<div class="outline"><i style="background:'+n.colors[r]+'"><\/i><\/div><div class="info-label">'+n.labels[r]+"<\/div>";return L.Browser.touch?L.DomEvent.on(i,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(i),L.DomEvent.on(i,"mousewheel",L.DomEvent.stopPropagation)),i}};return{getOnAddLegend:t,getOnAddArrayLegend:i,updateLegend:n}});n.module("leaflet-directive").factory("leafletMapDefaults",["$q","leafletHelpers",function(t,i){function e(){return{keyboard:!0,dragging:!0,worldCopyJump:!1,doubleClickZoom:!0,scrollWheelZoom:!0,tap:!0,touchZoom:!0,zoomControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",attributionControl:!0,controls:{layers:{visible:!0,position:"topright",collapsed:!0}},nominatim:{server:" http://nominatim.openstreetmap.org/search"},crs:L.CRS.EPSG3857,tileLayer:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap<\/a> contributors'},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var r=i.isDefined,o=i.isObject,f=i.obtainEffectiveMapId,u={};return{reset:function(){u={}},getDefaults:function(n){var t=f(u,n);return u[t]},getMapCreationDefaults:function(n){var o=f(u,n),t=u[o],i={maxZoom:t.maxZoom,keyboard:t.keyboard,dragging:t.dragging,zoomControl:t.zoomControl,doubleClickZoom:t.doubleClickZoom,scrollWheelZoom:t.scrollWheelZoom,tap:t.tap,touchZoom:t.touchZoom,attributionControl:t.attributionControl,worldCopyJump:t.worldCopyJump,crs:t.crs},e;if(r(t.minZoom)&&(i.minZoom=t.minZoom),r(t.zoomAnimation)&&(i.zoomAnimation=t.zoomAnimation),r(t.fadeAnimation)&&(i.fadeAnimation=t.fadeAnimation),r(t.markerZoomAnimation)&&(i.markerZoomAnimation=t.markerZoomAnimation),t.map)for(e in t.map)i[e]=t.map[e];return i},setDefaults:function(t,i){var s=e(),h;return r(t)&&(s.doubleClickZoom=r(t.doubleClickZoom)?t.doubleClickZoom:s.doubleClickZoom,s.scrollWheelZoom=r(t.scrollWheelZoom)?t.scrollWheelZoom:s.doubleClickZoom,s.tap=r(t.tap)?t.tap:s.tap,s.touchZoom=r(t.touchZoom)?t.touchZoom:s.doubleClickZoom,s.zoomControl=r(t.zoomControl)?t.zoomControl:s.zoomControl,s.zoomsliderControl=r(t.zoomsliderControl)?t.zoomsliderControl:s.zoomsliderControl,s.attributionControl=r(t.attributionControl)?t.attributionControl:s.attributionControl,s.tileLayer=r(t.tileLayer)?t.tileLayer:s.tileLayer,s.zoomControlPosition=r(t.zoomControlPosition)?t.zoomControlPosition:s.zoomControlPosition,s.keyboard=r(t.keyboard)?t.keyboard:s.keyboard,s.dragging=r(t.dragging)?t.dragging:s.dragging,r(t.controls)&&n.extend(s.controls,t.controls),o(t.crs)?s.crs=t.crs:r(L.CRS[t.crs])&&(s.crs=L.CRS[t.crs]),r(t.center)&&n.copy(t.center,s.center),r(t.tileLayerOptions)&&n.copy(t.tileLayerOptions,s.tileLayerOptions),r(t.maxZoom)&&(s.maxZoom=t.maxZoom),r(t.minZoom)&&(s.minZoom=t.minZoom),r(t.zoomAnimation)&&(s.zoomAnimation=t.zoomAnimation),r(t.fadeAnimation)&&(s.fadeAnimation=t.fadeAnimation),r(t.markerZoomAnimation)&&(s.markerZoomAnimation=t.markerZoomAnimation),r(t.worldCopyJump)&&(s.worldCopyJump=t.worldCopyJump),r(t.map)&&(s.map=t.map),r(t.path)&&(s.path=t.path)),h=f(u,i),u[h]=s,s}}}]);n.module("leaflet-directive").service("leafletMarkersHelpers",["$rootScope","$timeout","leafletHelpers","$log","$compile","leafletGeoJsonHelpers",function(t,i,r,u,f,e){var o=r.isDefined,k=r.defaultTo,rt=r.MarkerClusterPlugin,ut=r.AwesomeMarkersPlugin,ft=r.VectorMarkersPlugin,et=r.MakiMarkersPlugin,ot=r.ExtraMarkersPlugin,st=r.DomMarkersPlugin,y=r.safeApply,a=r,s=r.isString,d=r.isNumber,l=r.isObject,c={},p=e,h=r.errorHeader,g=function(n){var t="";return["_icon","_latlng","_leaflet_id","_map","_shadow"].forEach(function(i){t+=i+": "+k(n[i],"undefined")+" \n"}),"[leafletMarker] : \n"+t},ht=function(n,t){var i=t?console:u;i.debug(g(n))},w=function(i){var e,s;if(o(i)&&o(i.type)&&"awesomeMarker"===i.type)return ut.isLoaded()||u.error(h+" The AwesomeMarkers Plugin is not loaded."),new L.AwesomeMarkers.icon(i);if(o(i)&&o(i.type)&&"vectorMarker"===i.type)return ft.isLoaded()||u.error(h+" The VectorMarkers Plugin is not loaded."),new L.VectorMarkers.icon(i);if(o(i)&&o(i.type)&&"makiMarker"===i.type)return et.isLoaded()||u.error(h+"The MakiMarkers Plugin is not loaded."),new L.MakiMarkers.icon(i);if(o(i)&&o(i.type)&&"extraMarker"===i.type)return ot.isLoaded()||u.error(h+"The ExtraMarkers Plugin is not loaded."),new L.ExtraMarkers.icon(i);if(o(i)&&o(i.type)&&"div"===i.type)return new L.divIcon(i);if(o(i)&&o(i.type)&&"dom"===i.type){st.isLoaded()||u.error(h+"The DomMarkers Plugin is not loaded.");var c=n.isFunction(i.getMarkerScope)?i.getMarkerScope():t,l=f(i.template)(c),r=n.copy(i);return r.element=l[0],new L.DomMarkers.icon(r)}return o(i)&&o(i.type)&&"icon"===i.type?i.icon:(e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=",o(i)&&o(i.iconUrl)?new L.Icon(i):new L.Icon.Default({iconUrl:e,shadowUrl:s,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}))},ct=function(n){o(c[n])&&c.splice(n,1)},lt=function(){c={}},b=function(n,t,i){var r,u;if(n.closePopup(),o(i)&&o(i.overlays))for(r in i.overlays)if((i.overlays[r]instanceof L.LayerGroup||i.overlays[r]instanceof L.FeatureGroup)&&i.overlays[r].hasLayer(n))return void i.overlays[r].removeLayer(n);if(o(c))for(u in c)c[u].hasLayer(n)&&c[u].removeLayer(n);t.hasLayer(n)&&t.removeLayer(n)},at=function(n,t){var i=n._popup._container.offsetHeight,r=new L.Point(n._popup._containerLeft,-i-n._popup._containerBottom),u=t.layerPointToContainerPoint(r);null!==u&&n._popup._adjustPan()},vt=function(n,t){f(n._popup._contentNode)(t)},nt=function(n,t,r){var f=n._popup._contentNode.innerText||n._popup._contentNode.textContent,u;return f.length<1&&i(function(){nt(n,t,r)}),u=n._popup._contentNode.offsetWidth,n._popup._updateLayout(),n._popup._updatePosition(),n._popup.options.autoPan&&at(n,r),u},tt=function(i,r,f){var e=n.isFunction(r.getMessageScope)?r.getMessageScope():t,s=o(r.compileMessage)?r.compileMessage:!0;if(s){if(!o(i._popup)||!o(i._popup._contentNode))return u.error(h+"Popup is invalid or does not have any content."),!1;vt(i,e);nt(i,r,f)}},v=function(i,r){var u=n.isFunction(r.getMessageScope)?r.getMessageScope():t,e=n.isFunction(r.getLabelScope)?r.getLabelScope():u,s=o(r.compileMessage)?r.compileMessage:!0;a.LabelPlugin.isLoaded()&&o(r.label)&&(o(r.label.options)&&r.label.options.noHide===!0&&i.showLabel(),s&&o(i.label)&&f(i.label._container)(e))},it=function(t,i,r,f,e,c,y){var it,g,tt,nt,k,rt;if(o(i)){if(!p.validateCoords(t))return u.warn("There are problems with lat-lng data, please verify your marker model"),void b(r,y,c);if(it=t===i,o(t.iconAngle)&&i.iconAngle!==t.iconAngle&&r.setIconAngle(t.iconAngle),s(t.layer)||s(i.layer)&&(o(c.overlays[i.layer])&&c.overlays[i.layer].hasLayer(r)&&(c.overlays[i.layer].removeLayer(r),r.closePopup()),y.hasLayer(r)||y.addLayer(r)),(d(t.opacity)||d(parseFloat(t.opacity)))&&t.opacity!==i.opacity&&r.setOpacity(t.opacity),s(t.layer)&&i.layer!==t.layer){if(s(i.layer)&&o(c.overlays[i.layer])&&c.overlays[i.layer].hasLayer(r)&&c.overlays[i.layer].removeLayer(r),r.closePopup(),y.hasLayer(r)&&y.removeLayer(r),!o(c.overlays[t.layer]))return void u.error(h+"You must use a name of an existing layer");if(g=c.overlays[t.layer],!(g instanceof L.LayerGroup||g instanceof L.FeatureGroup))return void u.error(h+'A marker can only be added to a layer of type "group" or "featureGroup"');g.addLayer(r);y.hasLayer(r)&&t.focus===!0&&r.openPopup()}(t.draggable!==!0&&i.draggable===!0&&o(r.dragging)&&r.dragging.disable(),t.draggable===!0&&i.draggable!==!0&&(r.dragging?r.dragging.enable():L.Handler.MarkerDrag&&(r.dragging=new L.Handler.MarkerDrag(r),r.options.draggable=!0,r.dragging.enable())),l(t.icon)||l(i.icon)&&(r.setIcon(w()),r.closePopup(),r.unbindPopup(),s(t.message)&&r.bindPopup(t.message,t.popupOptions)),l(t.icon)&&l(i.icon)&&!n.equals(t.icon,i.icon))&&(tt=!1,r.dragging&&(tt=r.dragging.enabled()),r.setIcon(w(t.icon)),tt&&r.dragging.enable(),r.closePopup(),r.unbindPopup(),s(t.message)&&(r.bindPopup(t.message,t.popupOptions),y.hasLayer(r)&&t.focus===!0&&r.openPopup()));!s(t.message)&&s(i.message)&&(r.closePopup(),r.unbindPopup());a.LabelPlugin.isLoaded()&&(o(t.label)&&o(t.label.message)?"label"in i&&"message"in i.label&&!n.equals(t.label.message,i.label.message)?r.updateLabelContent(t.label.message):!n.isFunction(r.getLabel)||n.isFunction(r.getLabel)&&!o(r.getLabel())?(r.bindLabel(t.label.message,t.label.options),v(r,t)):v(r,t):(!("label"in t)||"message"in t.label)&&n.isFunction(r.unbindLabel)&&r.unbindLabel());s(t.message)&&!s(i.message)&&r.bindPopup(t.message,t.popupOptions);s(t.message)&&s(i.message)&&t.message!==i.message&&r.setPopupContent(t.message);nt=!1;t.focus!==!0&&i.focus===!0&&(r.closePopup(),nt=!0);(t.focus===!0&&(!o(i.focus)||i.focus===!1)||it&&t.focus===!0)&&(r.openPopup(),nt=!0);i.zIndexOffset!==t.zIndexOffset&&r.setZIndexOffset(t.zIndexOffset);k=r.getLatLng();rt=s(t.layer)&&a.MarkerClusterPlugin.is(c.overlays[t.layer]);rt?nt?(t.lat!==i.lat||t.lng!==i.lng)&&(c.overlays[t.layer].removeLayer(r),r.setLatLng([t.lat,t.lng]),c.overlays[t.layer].addLayer(r)):k.lat!==t.lat||k.lng!==t.lng?(c.overlays[t.layer].removeLayer(r),r.setLatLng([t.lat,t.lng]),c.overlays[t.layer].addLayer(r)):t.lat!==i.lat||t.lng!==i.lng?(c.overlays[t.layer].removeLayer(r),r.setLatLng([t.lat,t.lng]),c.overlays[t.layer].addLayer(r)):l(t.icon)&&l(i.icon)&&!n.equals(t.icon,i.icon)&&(c.overlays[t.layer].removeLayer(r),c.overlays[t.layer].addLayer(r)):(k.lat!==t.lat||k.lng!==t.lng)&&r.setLatLng([t.lat,t.lng])}};return{resetMarkerGroup:ct,resetMarkerGroups:lt,deleteMarker:b,manageOpenPopup:tt,manageOpenLabel:v,createMarker:function(n){var r,i,t,f;if(!o(n)||!p.validateCoords(n))return void u.error(h+"The marker definition is not valid.");if(r=p.getCoords(n),!o(r))return void u.error(h+"Unable to get coordinates from markerData.");i={icon:w(n.icon),title:o(n.title)?n.title:"",draggable:o(n.draggable)?n.draggable:!1,clickable:o(n.clickable)?n.clickable:!0,riseOnHover:o(n.riseOnHover)?n.riseOnHover:!1,zIndexOffset:o(n.zIndexOffset)?n.zIndexOffset:0,iconAngle:o(n.iconAngle)?n.iconAngle:0};for(t in n)n.hasOwnProperty(t)&&!i.hasOwnProperty(t)&&(i[t]=n[t]);return f=new L.marker(r,i),s(n.message)||f.unbindPopup(),f},addMarkerToGroup:function(n,t,i,r){return s(t)?rt.isLoaded()?(o(c[t])||(c[t]=new L.MarkerClusterGroup(i),r.addLayer(c[t])),void c[t].addLayer(n)):void u.error(h+"The MarkerCluster plugin is not loaded."):void u.error(h+"The marker group you have specified is invalid.")},listenMarkerEvents:function(n,t,i,r,u){n.on("popupopen",function(){y(i,function(){(o(n._popup)||o(n._popup._contentNode))&&(t.focus=!0,tt(n,t,u))})});n.on("popupclose",function(){y(i,function(){t.focus=!1})});n.on("add",function(){y(i,function(){"label"in t&&v(n,t)})})},updateMarker:it,addMarkerWatcher:function(n,t,i,r,u,f){var s=a.getObjectArrayPath("markers."+t),e;f=k(f,!0);e=i.$watch(s,function(f,s){return o(f)?void it(f,s,n,t,i,r,u):(b(n,u,r),void e())},f)},string:g,log:ht}}]);n.module("leaflet-directive").factory("leafletPathsHelpers",["$rootScope","$log","leafletHelpers",function(n,t,i){function o(n){return n.filter(function(n){return e(n)}).map(function(n){return c(n)})}function c(n){return f(n)?new L.LatLng(n[0],n[1]):new L.LatLng(n.lat,n.lng)}function a(n){return n.map(function(n){return o(n)})}function y(n,t){for(var i,u={},f=0;f<s.length;f++)i=s[f],r(n[i])?u[i]=n[i]:r(t.path[i])&&(u[i]=t.path[i]);return u}var r=i.isDefined,f=i.isArray,v=i.isNumber,e=i.isValidPoint,s=["stroke","weight","color","opacity","fill","fillColor","fillOpacity","dashArray","lineCap","lineJoin","clickable","pointerEvents","className","smoothFactor","noClip"],u=function(n,t){for(var u,f={},i=0;i<s.length;i++)u=s[i],r(t[u])&&(f[u]=t[u]);n.setStyle(t)},h=function(n){var t,i;if(!f(n))return!1;for(t=0;t<n.length;t++)if(i=n[t],!e(i))return!1;return!0},l={polyline:{isValid:function(n){var t=n.latlngs;return h(t)},createPath:function(n){return new L.Polyline([],n)},setPath:function(n,t){n.setLatLngs(o(t.latlngs));u(n,t)}},multiPolyline:{isValid:function(n){var t=n.latlngs,i,r;if(!f(t))return!1;for(i in t)if(r=t[i],!h(r))return!1;return!0},createPath:function(n){return new L.multiPolyline([[[0,0],[1,1]]],n)},setPath:function(n,t){n.setLatLngs(a(t.latlngs));u(n,t)}},polygon:{isValid:function(n){var t=n.latlngs;return h(t)},createPath:function(n){return new L.Polygon([],n)},setPath:function(n,t){n.setLatLngs(o(t.latlngs));u(n,t)}},multiPolygon:{isValid:function(n){var t=n.latlngs,i,r;if(!f(t))return!1;for(i in t)if(r=t[i],!h(r))return!1;return!0},createPath:function(n){return new L.MultiPolygon([[[0,0],[1,1],[0,1]]],n)},setPath:function(n,t){n.setLatLngs(a(t.latlngs));u(n,t)}},rectangle:{isValid:function(n){var t=n.latlngs,i,r;if(!f(t)||2!==t.length)return!1;for(i in t)if(r=t[i],!e(r))return!1;return!0},createPath:function(n){return new L.Rectangle([[0,0],[1,1]],n)},setPath:function(n,t){n.setBounds(new L.LatLngBounds(o(t.latlngs)));u(n,t)}},circle:{isValid:function(n){var t=n.latlngs;return e(t)&&v(n.radius)},createPath:function(n){return new L.Circle([0,0],1,n)},setPath:function(n,t){n.setLatLng(c(t.latlngs));r(t.radius)&&n.setRadius(t.radius);u(n,t)}},circleMarker:{isValid:function(n){var t=n.latlngs;return e(t)&&v(n.radius)},createPath:function(n){return new L.CircleMarker([0,0],n)},setPath:function(n,t){n.setLatLng(c(t.latlngs));r(t.radius)&&n.setRadius(t.radius);u(n,t)}}},p=function(n){var t={};return n.latlngs&&(t.latlngs=n.latlngs),n.radius&&(t.radius=n.radius),t};return{setPathOptions:function(n,t,i){r(t)||(t="polyline");l[t].setPath(n,i)},createPath:function(n,i,u){r(i.type)||(i.type="polyline");var f=y(i,u),e=p(i);return l[i.type].isValid(e)?l[i.type].createPath(f):void t.error("[AngularJS - Leaflet] Invalid data passed to the "+i.type+" path")}}}]);n.module("leaflet-directive").service("leafletWatchHelpers",function(){var n=function(n,t,i,r,u){var f=n[t](i,function(n,t){u(n,t);r.doWatch||f()},r.isDeep);return f},t=function(t,i,r,u){return n(t,"$watch",i,r,u)},i=function(t,i,r,u){return n(t,"$watchCollection",i,r,u)};return{maybeWatch:t,maybeWatchCollection:i}});n.module("leaflet-directive").factory("nominatimService",["$q","$http","leafletHelpers","leafletMapDefaults",function(n,t,i,r){var u=i.isDefined;return{query:function(i,f){var o=r.getDefaults(f),s=o.nominatim.server,e=n.defer();return t.get(s,{params:{format:"json",limit:1,q:i}}).success(function(n){n.length>0&&u(n[0].boundingbox)?e.resolve(n[0]):e.reject("[Nominatim] Invalid address")}),e.promise}}}]);n.module("leaflet-directive").directive("bounds",["$log","$timeout","$http","leafletHelpers","nominatimService","leafletBoundsHelpers",function(t,i,r,u,f,e){return{restrict:"A",scope:!1,replace:!1,require:["leaflet"],link:function(r,o,s,h){var l=u.isDefined,a=e.createLeafletBounds,c=h[0].getLeafletScope(),v=h[0],y=u.errorHeader+" [Bounds] ",p=function(n){return 0===n._southWest.lat&&0===n._southWest.lng&&0===n._northEast.lat&&0===n._northEast.lng};v.getMap().then(function(u){c.$on("boundsChanged",function(t){var f=t.currentScope,r=u.getBounds(),e;p(r)||f.settingBoundsFromScope||(f.settingBoundsFromLeaflet=!0,e={northEast:{lat:r._northEast.lat,lng:r._northEast.lng},southWest:{lat:r._southWest.lat,lng:r._southWest.lng},options:r.options},n.equals(f.bounds,e)||(f.bounds=e),i(function(){f.settingBoundsFromLeaflet=!1}))});var e;c.$watch("bounds",function(n){if(!r.settingBoundsFromLeaflet){if(l(n.address)&&n.address!==e)return r.settingBoundsFromScope=!0,f.query(n.address,s.id).then(function(n){var t=n.boundingbox,i=[[t[0],t[2]],[t[1],t[3]]];u.fitBounds(i)},function(n){t.error(y+" "+n+".")}),e=n.address,void i(function(){r.settingBoundsFromScope=!1});var o=a(n);o&&!u.getBounds().equals(o)&&(r.settingBoundsFromScope=!0,u.fitBounds(o,n.options),i(function(){r.settingBoundsFromScope=!1}))}},!0)})}}}]);var t=["center","lfCenter"],i={};t.forEach(function(t){i[t]=["$log","$q","$location","$timeout","leafletMapDefaults","leafletHelpers","leafletBoundsHelpers","leafletMapEvents",function(i,r,u,f,e,o,s,h){var a,c=o.isDefined,p=o.isNumber,v=o.isSameCenterOnMap,y=o.safeApply,w=o.isValidCenter,b=s.isValidBounds,k=o.isUndefinedOrEmpty,l=o.errorHeader,d=function(n,t){return c(n)&&b(n)&&k(t)};return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){a=r.defer();this.getCenter=function(){return a.promise}},link:function(r,o,b,k){var g=k.getLeafletScope(),nt=g[t];k.getMap().then(function(r){var o=e.getDefaults(b.id),k,it,tt;if(-1!==b[t].search("-"))return i.error(l+' The "center" variable can\'t use a "-" on its key name: "'+b[t]+'".'),void r.setView([o.center.lat,o.center.lng],o.center.zoom);if(d(g.bounds,nt))r.fitBounds(s.createLeafletBounds(g.bounds),g.bounds.options),nt=r.getCenter(),y(g,function(i){n.extend(i[t],{lat:r.getCenter().lat,lng:r.getCenter().lng,zoom:r.getZoom(),autoDiscover:!1})}),y(g,function(n){var t=r.getBounds();n.bounds={northEast:{lat:t._northEast.lat,lng:t._northEast.lng},southWest:{lat:t._southWest.lat,lng:t._southWest.lng}}});else{if(!c(nt))return i.error(l+' The "center" property is not defined in the main scope'),void r.setView([o.center.lat,o.center.lng],o.center.zoom);c(nt.lat)&&c(nt.lng)||c(nt.autoDiscover)||n.copy(o.center,nt)}"yes"===b.urlHashCenter&&(tt=function(){var t,i=u.search(),n;return c(i.c)&&(n=i.c.split(":"),3===n.length&&(t={lat:parseFloat(n[0]),lng:parseFloat(n[1]),zoom:parseInt(n[2],10)})),t},k=tt(),g.$on("$locationChangeSuccess",function(i){var f=i.currentScope,u=tt();c(u)&&!v(u,r)&&n.extend(f[t],{lat:u.lat,lng:u.lng,zoom:u.zoom})}));g.$watch(t,function(t){if(!g.settingCenterFromLeaflet)return(c(k)&&(n.copy(k,t),k=void 0),w(t)||t.autoDiscover===!0?t.autoDiscover===!0?(p(t.zoom)||r.setView([o.center.lat,o.center.lng],o.center.zoom),void(p(t.zoom)&&t.zoom>o.center.zoom?r.locate({setView:!0,maxZoom:t.zoom}):c(o.maxZoom)?r.locate({setView:!0,maxZoom:o.maxZoom}):r.locate({setView:!0}))):void(it&&v(t,r)||(g.settingCenterFromScope=!0,r.setView([t.lat,t.lng],t.zoom),h.notifyCenterChangedToBounds(g,r),f(function(){g.settingCenterFromScope=!1}))):void i.warn(l+" invalid 'center'"))},!0);r.whenReady(function(){it=!0});r.on("moveend",function(){a.resolve();h.notifyCenterUrlHashChanged(g,r,b,u.search());v(nt,r)||g.settingCenterFromScope||(g.settingCenterFromLeaflet=!0,y(g,function(i){g.settingCenterFromScope||n.extend(i[t],{lat:r.getCenter().lat,lng:r.getCenter().lng,zoom:r.getZoom(),autoDiscover:!1});h.notifyCenterChangedToBounds(g,r);f(function(){g.settingCenterFromLeaflet=!1})}))});nt.autoDiscover===!0&&r.on("locationerror",function(){i.warn(l+" The Geolocation API is unauthorized on this page.");w(nt)?(r.setView([nt.lat,nt.lng],nt.zoom),h.notifyCenterChangedToBounds(g,r)):(r.setView([o.center.lat,o.center.lng],o.center.zoom),h.notifyCenterChangedToBounds(g,r))})})}}}]});t.forEach(function(t){n.module("leaflet-directive").directive(t,i[t])});n.module("leaflet-directive").directive("controls",["$log","leafletHelpers","leafletControlHelpers",function(n,t,i){return{restrict:"A",scope:!1,replace:!1,require:"?^leaflet",link:function(r,u,f,e){if(e){var h=i.createControl,c=i.isValidControlType,l=e.getLeafletScope(),s=t.isDefined,a=t.isArray,o={},v=t.errorHeader+" [Controls] ";e.getMap().then(function(t){l.$watchCollection("controls",function(i){var f,r,y,e,u,p,l;for(f in o)s(i[f])||(t.hasControl(o[f])&&t.removeControl(o[f]),delete o[f]);for(r in i){if(e=s(i[r].type)?i[r].type:r,!c(e))return void n.error(v+" Invalid control type: "+e+".");if("custom"!==e)y=h(e,i[r]),t.addControl(y),o[r]=y;else if(u=i[r],a(u))for(p in u)l=u[p],t.addControl(l),o[r]=s(o[r])?o[r].concat([l]):[l];else t.addControl(u),o[r]=u}})})}}}}]);n.module("leaflet-directive").directive("decorations",["$log","leafletHelpers",function(t,i){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(r,u,f,e){function h(n){return o(n)&&o(n.coordinates)&&(a.isLoaded()||t.error("[AngularJS - Leaflet] The PolylineDecorator Plugin is not loaded.")),L.polylineDecorator(n.coordinates)}function c(n,t){if(o(n)&&o(t)&&o(t.coordinates)&&o(t.patterns))return(n.setPaths(t.coordinates),n.setPatterns(t.patterns),n)}var l=e.getLeafletScope(),a=i.PolylineDecoratorPlugin,o=i.isDefined,s={};e.getMap().then(function(t){l.$watch("decorations",function(i){var r,f,e,u;for(r in s)o(i[r])&&n.equals(i[r],s)||(t.removeLayer(s[r]),delete s[r]);for(f in i)e=i[f],u=h(e),o(u)&&(s[f]=u,t.addLayer(u),c(u,e))},!0)})}}}]);n.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope","leafletHelpers","leafletMapEvents","leafletIterators",function(n,t,i,r,u){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(t,f,e,o){var h=i.isObject,a=i.isDefined,c=o.getLeafletScope(),s=c.eventBroadcast,l=r.getAvailableMapEvents(),v=r.addEvents;o.getMap().then(function(t){var i=[],r="broadcast";a(s.map)?h(s.map)?("emit"!==s.map.logic&&"broadcast"!==s.map.logic?n.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):r=s.map.logic,h(s.map.enable)&&s.map.enable.length>=0?u.each(s.map.enable,function(n){-1===i.indexOf(n)&&-1!==l.indexOf(n)&&i.push(n)}):n.warn("[AngularJS - Leaflet] event-broadcast.map.enable must be an object check your model.")):n.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model."):i=l;v(t,i,"eventName",c,r)})}}}]);n.module("leaflet-directive").directive("geojson",["$log","$rootScope","leafletData","leafletHelpers","leafletWatchHelpers","leafletDirectiveControlsHelpers","leafletIterators","leafletGeoJsonEvents",function(t,i,r,u,f,e,o,s){var l=f.maybeWatch,a=u.watchOptions,v=e.extend,h=u,c=o;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(t,i,f,e){var y=u.isDefined,p=e.getLeafletScope(),o={},w=!1;e.getMap().then(function(t){var d=p.geojsonWatchOptions||a,g=function(t,i){return n.isFunction(t.onEachFeature)?t.onEachFeature:function(n,r){u.LabelPlugin.isLoaded()&&y(n.properties.description)&&r.bindLabel(n.properties.description);s.bindEvents(f.id,r,null,n,p,i,{resetStyleOnMouseout:t.resetStyleOnMouseout,mapId:f.id})}},i=h.isDefined(f.geojsonNested)&&h.isTruthy(f.geojsonNested),e=function(){if(o){var n=function(n){y(n)&&t.hasLayer(n)&&t.removeLayer(n)};return i?void c.each(o,function(t){n(t)}):void n(o)}},b=function(i,u){var e=n.copy(i),c,s;y(e)&&y(e.data)&&(c=g(e,u),y(e.options)||(e.options={style:e.style,filter:e.filter,onEachFeature:c,pointToLayer:e.pointToLayer}),s=L.geoJson(e.data,e.options),u&&h.isString(u)?o[u]=s:o=s,s.addTo(t),w||(w=!0,r.setGeoJSON(o,f.id)))},k=function(n){if(e(),i)return!n||!Object.keys(n).length?void 0:void c.each(n,function(n,t){b(n,t)});b(n)};v(f.id,"geojson",k,e);l(p,"geojson",d,function(n){k(n)})})}}}]);n.module("leaflet-directive").directive("layercontrol",["$filter","$log","leafletData","leafletHelpers",function(t,i,r,u){return{restrict:"E",scope:{icons:"=?",autoHideOpacity:"=?",showGroups:"=?",title:"@",baseTitle:"@",overlaysTitle:"@"},replace:!0,transclude:!1,require:"^leaflet",controller:["$scope","$element","$sce",function(t,f,e){var h,s,o;i.debug("[Angular Directive - Layers] layers",t,f);h=u.safeApply;s=u.isDefined;n.extend(t,{baselayer:"",oldGroup:"",layerProperties:{},groupProperties:{},rangeIsSupported:u.rangeIsSupported(),changeBaseLayer:function(n,i){u.safeApply(t,function(i){i.baselayer=n;r.getMap().then(function(u){r.getLayers().then(function(r){if(!u.hasLayer(r.baselayers[n])){for(var f in i.layers.baselayers)i.layers.baselayers[f].icon=i.icons.unradio,u.hasLayer(r.baselayers[f])&&u.removeLayer(r.baselayers[f]);u.addLayer(r.baselayers[n]);i.layers.baselayers[n].icon=t.icons.radio}})})});i.preventDefault()},moveLayer:function(n,i,r){var e=Object.keys(t.layers.baselayers).length,u,f;if(i>=1+e&&i<=t.overlaysArray.length+e){for(f in t.layers.overlays)if(t.layers.overlays[f].index===i){u=t.layers.overlays[f];break}u&&h(t,function(){u.index=n.index;n.index=i})}r.stopPropagation();r.preventDefault()},initIndex:function(n,i){var r=Object.keys(t.layers.baselayers).length;n.index=s(n.index)?n.index:i+r+1},initGroup:function(n){t.groupProperties[n]=t.groupProperties[n]?t.groupProperties[n]:{}},toggleOpacity:function(n,i){if(i.visible){if(t.autoHideOpacity&&!t.layerProperties[i.name].opacityControl)for(var r in t.layerProperties)t.layerProperties[r].opacityControl=!1;t.layerProperties[i.name].opacityControl=!t.layerProperties[i.name].opacityControl}n.stopPropagation();n.preventDefault()},toggleLegend:function(n){t.layerProperties[n.name].showLegend=!t.layerProperties[n.name].showLegend},showLegend:function(n){return n.legend&&t.layerProperties[n.name].showLegend},unsafeHTML:function(n){return e.trustAsHtml(n)},getOpacityIcon:function(n){return n.visible&&t.layerProperties[n.name].opacityControl?t.icons.close:t.icons.open},getGroupIcon:function(n){return n.visible?t.icons.check:t.icons.uncheck},changeOpacity:function(n){var i=t.layerProperties[n.name].opacity;r.getMap().then(function(u){r.getLayers().then(function(r){var f;for(var e in t.layers.overlays)if(t.layers.overlays[e]===n){f=r.overlays[e];break}u.hasLayer(f)&&(f.setOpacity&&f.setOpacity(i/100),f.getLayers&&f.eachLayer&&f.eachLayer(function(n){n.setOpacity&&n.setOpacity(i/100)}))})})},changeGroupVisibility:function(n){var r,u,i;if(s(t.groupProperties[n])){r=t.groupProperties[n].visible;for(u in t.layers.overlays)i=t.layers.overlays[u],i.group===n&&(i.visible=r)}}});o=f.get(0);L.Browser.touch?L.DomEvent.on(o,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(o),L.DomEvent.on(o,"mousewheel",L.DomEvent.stopPropagation))}],template:'<div class="angular-leaflet-control-layers" ng-show="overlaysArray.length"><h4 ng-if="title">{{ title }}<\/h4><div class="lf-baselayers"><h5 class="lf-title" ng-if="baseTitle">{{ baseTitle }}<\/h5><div class="lf-row" ng-repeat="(key, layer) in baselayersArray"><label class="lf-icon-bl" ng-click="changeBaseLayer(key, $event)"><input class="leaflet-control-layers-selector" type="radio" name="lf-radio" ng-show="false" ng-checked="baselayer === key" ng-value="key" /> <i class="lf-icon lf-icon-radio" ng-class="layer.icon"><\/i><div class="lf-text">{{layer.name}}<\/div><\/label><\/div><\/div><div class="lf-overlays"><h5 class="lf-title" ng-if="overlaysTitle">{{ overlaysTitle }}<\/h5><div class="lf-container"><div class="lf-row" ng-repeat="layer in (o = (overlaysArray | orderBy:\'index\':order))" ng-init="initIndex(layer, $index)"><label class="lf-icon-ol-group" ng-if="showGroups &amp;&amp; layer.group &amp;&amp; layer.group != o[$index-1].group"><input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-change="changeGroupVisibility(layer.group)" ng-model="groupProperties[layer.group].visible"/> <i class="lf-icon lf-icon-check" ng-class="getGroupIcon(groupProperties[layer.group])"><\/i><div class="lf-text">{{ layer.group }}<\/div><\/label><label class="lf-icon-ol"><input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-model="layer.visible"/> <i class="lf-icon lf-icon-check" ng-class="layer.icon"><\/i><div class="lf-text">{{layer.name}}<\/div><\/label><div class="lf-icons"><i class="lf-icon lf-up" ng-class="icons.up" ng-click="moveLayer(layer, layer.index - orderNumber, $event)"><\/i> <i class="lf-icon lf-down" ng-class="icons.down" ng-click="moveLayer(layer, layer.index + orderNumber, $event)"><\/i> <i class="lf-icon lf-toggle-legend" ng-class="icons.toggleLegend" ng-if="layer.legend" ng-click="toggleLegend(layer)"><\/i> <i class="lf-icon lf-open" ng-class="getOpacityIcon(layer)" ng-click="toggleOpacity($event, layer)"><\/i><\/div><div class="lf-legend" ng-if="showLegend(layer)" ng-bind-html="unsafeHTML(layer.legend)"><\/div><div class="lf-opacity clearfix" ng-if="layer.visible &amp;&amp; layerProperties[layer.name].opacityControl"><label ng-if="rangeIsSupported" class="pull-left" style="width: 50%">0<\/label><label ng-if="rangeIsSupported" class="pull-left text-right" style="width: 50%">100<\/label><input ng-if="rangeIsSupported" class="clearfix" type="range" min="0" max="100" class="lf-opacity-control" ng-model="layerProperties[layer.name].opacity" ng-change="changeOpacity(layer)"/><h6 ng-if="!rangeIsSupported">Range is not supported in this browser<\/h6><\/div><\/div><\/div><\/div><\/div>',link:function(t,i,f,e){var o=u.isDefined,s=e.getLeafletScope(),h=s.layers;t.$watch("icons",function(){var i={uncheck:"fa fa-square-o",check:"fa fa-check-square-o",radio:"fa fa-dot-circle-o",unradio:"fa fa-circle-o",up:"fa fa-angle-up",down:"fa fa-angle-down",open:"fa fa-angle-double-down",close:"fa fa-angle-double-up",toggleLegend:"fa fa-pencil-square-o"};o(t.icons)?(n.extend(i,t.icons),n.extend(t.icons,i)):t.icons=i});f.order=!o(f.order)||"normal"!==f.order&&"reverse"!==f.order?"normal":f.order;t.order="normal"===f.order;t.orderNumber="normal"===f.order?-1:1;t.layers=h;e.getMap().then(function(n){s.$watch("layers.baselayers",function(i){var u={};r.getLayers().then(function(r){var f,e;for(f in i)e=i[f],e.icon=t.icons[n.hasLayer(r.baselayers[f])?"radio":"unradio"],u[f]=e;t.baselayersArray=u})});s.$watch("layers.overlays",function(n){var u=[],i={};r.getLayers().then(function(r){var e,f;for(e in n)f=n[e],f.icon=t.icons[f.visible?"check":"uncheck"],u.push(f),o(t.layerProperties[f.name])||(t.layerProperties[f.name]={opacity:o(f.layerOptions.opacity)?100*f.layerOptions.opacity:100,opacityControl:!1,showLegend:!0}),o(f.group)&&(o(t.groupProperties[f.group])||(t.groupProperties[f.group]={visible:!1}),i[f.group]=o(i[f.group])?i[f.group]:{count:0,visibles:0},i[f.group].count++,f.visible&&i[f.group].visibles++),o(f.index)&&r.overlays[e].setZIndex&&r.overlays[e].setZIndex(n[e].index);for(e in i)t.groupProperties[e].visible=i[e].visibles===i[e].count;t.overlaysArray=u})},!0)})}}}]);n.module("leaflet-directive").directive("layers",["$log","$q","leafletData","leafletHelpers","leafletLayerHelpers","leafletControlHelpers",function(t,i,r,u,f,e){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:["$scope",function(n){n._leafletLayers=i.defer();this.getLayers=function(){return n._leafletLayers.promise}}],link:function(t,i,o,s){var l=u.isDefined,h={},w=s.getLeafletScope(),c=w.layers,y=f.createLayer,a=f.safeAddLayer,b=f.safeRemoveLayer,p=e.updateLayersControl,v=!1;s.getMap().then(function(i){var f,e,u,s,k;t._leafletLayers.resolve(h);r.setLayers(h,o.id);h.baselayers={};h.overlays={};f=o.id;e=!1;for(u in c.baselayers)s=y(c.baselayers[u]),l(s)?(h.baselayers[u]=s,c.baselayers[u].top===!0&&(a(i,h.baselayers[u]),e=!0)):delete c.baselayers[u];!e&&Object.keys(h.baselayers).length>0&&a(i,h.baselayers[Object.keys(c.baselayers)[0]]);for(u in c.overlays)k=y(c.overlays[u]),l(k)?(h.overlays[u]=k,c.overlays[u].visible===!0&&a(i,h.overlays[u])):delete c.overlays[u];w.$watch("layers.baselayers",function(t,r){var e,u,o,s,w;if(n.equals(t,r))return v=p(i,f,v,t,c.overlays,h),!0;for(e in h.baselayers)(!l(t[e])||t[e].doRefresh)&&(i.hasLayer(h.baselayers[e])&&i.removeLayer(h.baselayers[e]),delete h.baselayers[e],t[e]&&t[e].doRefresh&&(t[e].doRefresh=!1));for(u in t)l(h.baselayers[u])?t[u].top!==!0||i.hasLayer(h.baselayers[u])?t[u].top===!1&&i.hasLayer(h.baselayers[u])&&i.removeLayer(h.baselayers[u]):a(i,h.baselayers[u]):(o=y(t[u]),l(o)&&(h.baselayers[u]=o,t[u].top===!0&&a(i,h.baselayers[u])));s=!1;for(w in h.baselayers)if(i.hasLayer(h.baselayers[w])){s=!0;break}!s&&Object.keys(h.baselayers).length>0&&a(i,h.baselayers[Object.keys(h.baselayers)[0]]);v=p(i,f,v,t,c.overlays,h)},!0);w.$watch("layers.overlays",function(t,r){var e,s,u,o;if(n.equals(t,r))return v=p(i,f,v,c.baselayers,t,h),!0;for(e in h.overlays)(!l(t[e])||t[e].doRefresh)&&(i.hasLayer(h.overlays[e])&&(s=l(t[e])?t[e].layerOptions:null,b(i,h.overlays[e],s)),delete h.overlays[e],t[e]&&t[e].doRefresh&&(t[e].doRefresh=!1));for(u in t){if(l(h.overlays[u]))t[u].visible&&!i.hasLayer(h.overlays[u])?a(i,h.overlays[u]):t[u].visible===!1&&i.hasLayer(h.overlays[u])&&b(i,h.overlays[u],t[u].layerOptions);else{if(o=y(t[u]),!l(o))continue;h.overlays[u]=o;t[u].visible===!0&&a(i,h.overlays[u])}t[u].visible&&i._loaded&&t[u].data&&"heatmap"===t[u].type&&(h.overlays[u].setData(t[u].data),h.overlays[u].update())}v=p(i,f,v,c.baselayers,t,h)},!0)})}}}]);n.module("leaflet-directive").directive("legend",["$log","$http","leafletHelpers","leafletLegendHelpers",function(n,t,i,r){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(u,f,e,o){var a,v,s,c,p=i.isArray,h=i.isDefined,w=i.isFunction,l=o.getLeafletScope(),y=l.legend;l.$watch("legend",function(n){h(n)&&(a=n.legendClass?n.legendClass:"legend",v=n.position||"bottomright",c=n.type||"arcgis")},!0);o.getMap().then(function(i){l.$watch("legend",function(t){return h(t)?h(t.url)||"arcgis"!==c||p(t.colors)&&p(t.labels)&&t.colors.length===t.labels.length?h(t.url)?void n.info("[AngularJS - Leaflet] loading legend service."):(h(s)&&(s.removeFrom(i),s=null),s=L.control({position:v}),"arcgis"===c&&(s.onAdd=r.getOnAddArrayLegend(t,a)),void s.addTo(i)):void n.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set."):void(h(s)&&(s.removeFrom(i),s=null))});l.$watch("legend.url",function(u){h(u)&&t.get(u).success(function(n){h(s)?r.updateLegend(s.getContainer(),n,c,u):(s=L.control({position:v}),s.onAdd=r.getOnAddLegend(n,a,c,u),s.addTo(i));h(y.loadedData)&&w(y.loadedData)&&y.loadedData()}).error(function(){n.warn("[AngularJS - Leaflet] legend.url not loaded.")})})})}}}]);n.module("leaflet-directive").directive("markers",["$log","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults","leafletMarkersHelpers","leafletMarkerEvents","leafletIterators","leafletWatchHelpers","leafletDirectiveControlsHelpers",function(t,i,r,u,f,e,o,s,h,c,l){var a=f.isDefined,v=f.errorHeader,y=f,p=f.isString,nt=o.addMarkerWatcher,tt=o.updateMarker,it=o.listenMarkerEvents,rt=o.addMarkerToGroup,ut=o.createMarker,ft=o.deleteMarker,w=h,et=f.watchOptions,ot=c.maybeWatch,st=l.extend,ht=function(n,t,i){if(Object.keys(n).length)return i&&p(i)?!n[i]||!Object.keys(n[i]).length?void 0:n[i][t]:n[t]},ct=function(n,t,i,r){return r&&p(r)?(a(t[r])||(t[r]={}),t[r][i]=n):t[i]=n,n},lt=function(n,i,r,u,f,e){if(!p(n))return t.error(v+" A layername must be a string"),!1;if(!a(i))return t.error(v+" You must add layers to the directive if the markers are going to use this functionality."),!1;if(!a(i.overlays)||!a(i.overlays[n]))return t.error(v+' A marker can only be added to a layer of type "group"'),!1;var o=i.overlays[n];return o instanceof L.LayerGroup||o instanceof L.FeatureGroup?(o.addLayer(u),!f&&e.hasLayer(u)&&r.focus===!0&&u.openPopup(),!0):(t.error(v+' Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"'),!1)},b=function(n,i,r,u,f,e,o,h,c,l){var b,d,w,g,et,ot;for(b in i)if(!l[b])if(-1===b.search("-")){var p=y.copy(i[b]),k=y.getObjectDotPath(c?[c,b]:[b]),ft=ht(e,b,c);if(a(ft))d=a(d)?r[b]:void 0,tt(p,d,ft,k,o,f,u);else{if(w=ut(p),g=(p?p.layer:void 0)||c,!a(w)){t.error(v+" Received invalid data on the marker "+b+".");continue}if((ct(w,e,b,c),a(p.message)&&w.bindPopup(p.message,p.popupOptions),a(p.group))&&(et=a(p.groupOption)?p.groupOption:null,rt(w,p.group,et,u)),y.LabelPlugin.isLoaded()&&a(p.label)&&a(p.label.message)&&w.bindLabel(p.label.message,p.label.options),a(p)&&(a(p.layer)||a(c))){if(ot=lt(g,f,p,w,h.individual.doWatch,u),!ot)continue}else a(p.group)||(u.addLayer(w),h.individual.doWatch||p.focus!==!0||w.openPopup());h.individual.doWatch&&nt(w,k,o,f,u,h.individual.isDeep);it(w,p,o,h.individual.doWatch,u);s.bindEvents(n,w,k,p,o,g)}}else t.error('The marker can\'t use a "-" on his key name: "'+b+'".')},k=function(i,r,u,f,e){var s,h,c=!1,l=!1,p=a(r);for(var o in u)c||(t.debug(v+"[markers] destroy: "),c=!0),p&&(h=i[o],s=r[o],l=n.equals(h,s)&&f),a(i)&&Object.keys(i).length&&a(i[o])&&Object.keys(i[o]).length&&!l||e&&y.isFunction(e)&&e(h,s,o)},d=function(n,i,r,u,f){k(n,i,r,!1,function(n,i,e){t.debug(v+"[marker] is deleting marker: "+e);ft(r[e],u,f);delete r[e]})},g=function(n,i,r){var u={};return k(n,i,r,!0,function(n,i,r){t.debug(v+"[marker] is already rendered, marker: "+r);u[r]=n}),u};return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(n,t,i,f){var o=f[0],e=o.getLeafletScope();o.getMap().then(function(n){var h,t={},o,s;h=a(f[1])?f[1].getLayers:function(){var n=r.defer();return n.resolve(),n.promise};o=e.markersWatchOptions||et;a(i.watchMarkers)&&(o.doWatch=o.individual.doWatch=!a(i.watchMarkers)||y.isTruthy(i.watchMarkers));s=a(i.markersNested)&&y.isTruthy(i.markersNested);h().then(function(r){var f=function(i,u){return s?void w.each(i,function(i,f){var e=a(e)?u[f]:void 0;d(i,e,t[f],n,r)}):void d(i,u,t,n,r)},h=function(u,h){f(u,h);var c=null;return s?void w.each(u,function(f,s){var l=a(l)?h[s]:void 0;c=g(u[s],l,t[s]);b(i.id,f,h,n,r,t,e,o,s,c)}):(c=g(u,h,t),void b(i.id,u,h,n,r,t,e,o,void 0,c))};st(i.id,"markers",h,f);u.setMarkers(t,i.id);ot(e,"markers",o,function(n,t){h(n,t)})})})}}}]);n.module("leaflet-directive").directive("maxbounds",["$log","leafletMapDefaults","leafletBoundsHelpers","leafletHelpers",function(n,t,i,r){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(n,t,u,f){var e=f.getLeafletScope(),o=i.isValidBounds,s=r.isNumber;f.getMap().then(function(n){e.$watch("maxbounds",function(t){if(!o(t))return void n.setMaxBounds();var r=i.createLeafletBounds(t);s(t.pad)&&(r=r.pad(t.pad));n.setMaxBounds(r);u.center||u.lfCenter||n.fitBounds(r)})})}}}]);n.module("leaflet-directive").directive("paths",["$log","$q","leafletData","leafletMapDefaults","leafletHelpers","leafletPathsHelpers","leafletPathEvents",function(n,t,i,r,u,f,e){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(o,s,h,c){var y=c[0],l=u.isDefined,p=u.isString,a=y.getLeafletScope(),w=a.paths,b=f.createPath,k=e.bindPathEvents,v=f.setPathOptions;y.getMap().then(function(f){var e,o=r.getDefaults(h.id);e=l(c[1])?c[1].getLayers:function(){var n=t.defer();return n.resolve(),n.promise};l(w)&&e().then(function(t){var r={},e,s;i.setPaths(r,h.id);e=!l(h.watchPaths)||"true"===h.watchPaths;s=function(n,i){var r=a.$watch('paths["'+i+'"]',function(i,u){var e,o;if(!l(i)){if(l(u.layer))for(e in t.overlays)o=t.overlays[e],o.removeLayer(n);return f.removeLayer(n),void r()}v(n,i.type,i)},!0)};a.$watchCollection("paths",function(i){var d,w,c,y,g;for(d in r)l(i[d])||(f.removeLayer(r[d]),delete r[d]);for(w in i)if(0!==w.search("\\$"))if(-1===w.search("-")){if(!l(r[w])){if(c=i[w],y=b(w,i[w],o),l(y)&&l(c.message)&&y.bindPopup(c.message,c.popupOptions),u.LabelPlugin.isLoaded()&&l(c.label)&&l(c.label.message)&&y.bindLabel(c.label.message,c.label.options),l(c)&&l(c.layer)){if(!p(c.layer)){n.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!l(t)){n.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!l(t.overlays)||!l(t.overlays[c.layer])){n.error('[AngularJS - Leaflet] A path can only be added to a layer of type "group"');continue}if(g=t.overlays[c.layer],!(g instanceof L.LayerGroup||g instanceof L.FeatureGroup)){n.error('[AngularJS - Leaflet] Adding a path to an overlay needs a overlay of the type "group" or "featureGroup"');continue}r[w]=y;g.addLayer(y);e?s(y,w):v(y,c.type,c)}else l(y)&&(r[w]=y,f.addLayer(y),e?s(y,w):v(y,c.type,c));k(h.id,y,w,c,a)}}else n.error('[AngularJS - Leaflet] The path name "'+w+'" is not valid. It must not include "-" and a number.')})})})}}}]);n.module("leaflet-directive").directive("tiles",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(t,i,r,u){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(f,e,o,s){var h=u.isDefined,c=s.getLeafletScope(),l=c.tiles;return h(l)&&h(l.url)?void s.getMap().then(function(t){var u,f=r.getDefaults(o.id);c.$watch("tiles",function(r,e){var s=f.tileLayerOptions,c=f.tileLayer;return!h(r.url)&&h(u)?void t.removeLayer(u):h(u)?!h(r.url)||!h(r.options)||r.type===e.type&&n.equals(r.options,s)?void(h(r.url)&&u.setUrl(r.url)):(t.removeLayer(u),s=f.tileLayerOptions,n.copy(r.options,s),c=r.url,u="wms"===r.type?L.tileLayer.wms(c,s):L.tileLayer(c,s),u.addTo(t),void i.setTiles(u,o.id)):(h(r.options)&&n.copy(r.options,s),h(r.url)&&(c=r.url),u="wms"===r.type?L.tileLayer.wms(c,s):L.tileLayer(c,s),u.addTo(t),void i.setTiles(u,o.id))},!0)}):void t.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property.")}}}]);["markers","geojson"].forEach(function(t){n.module("leaflet-directive").directive(t+"WatchOptions",["$log","$rootScope","$q","leafletData","leafletHelpers",function(i,r,u,f,e){var s=e.isDefined,h=e.errorHeader,c=e.isObject,o=e.watchOptions;return{restrict:"A",scope:!1,replace:!1,require:["leaflet"],link:function(r,u,f,e){var l=e[0],a=l.getLeafletScope();l.getMap().then(function(){s(r[t+"WatchOptions"])&&(c(r[t+"WatchOptions"])?n.extend(o,r[t+"WatchOptions"]):i.error(h+"["+t+"WatchOptions] is not an object"),a[t+"WatchOptions"]=o)})}}}])});n.module("leaflet-directive").factory("LeafletEventsHelpersFactory",["$rootScope","$q","$log","leafletHelpers",function(t,i,r,u){var c=u.safeApply,e=u.isDefined,s=u.isObject,h=u.isArray,f=u.errorHeader,o=function(n,t){this.rootBroadcastName=n;r.debug("LeafletEventsHelpersFactory: lObjectType: "+t+"rootBroadcastName: "+n);this.lObjectType=t};return o.prototype.getAvailableEvents=function(){return[]},o.prototype.genDispatchEvent=function(n,t,i,u,f,e,o,s,h){var c=this;return n=n||"",n&&(n="."+n),function(l){var a=c.rootBroadcastName+n+"."+t;r.debug(a);c.fire(u,a,i,l,l.target||f,o,e,s,h)}},o.prototype.fire=function(i,r,u,f,o,s,h,l){c(i,function(){var c={leafletEvent:f,leafletObject:o,modelName:h,model:s};e(l)&&n.extend(c,{layerName:l});"emit"===u?i.$emit(r,c):t.$broadcast(r,c)})},o.prototype.bindEvents=function(n,t,i,u,o,c,l){var v=[],w="emit",a=this,y,p;return e(o.eventBroadcast)?s(o.eventBroadcast)?e(o.eventBroadcast[a.lObjectType])?s(o.eventBroadcast[a.lObjectType])?(e(o.eventBroadcast[this.lObjectType].logic)&&"emit"!==o.eventBroadcast[a.lObjectType].logic&&"broadcast"!==o.eventBroadcast[a.lObjectType].logic&&r.warn(f+"Available event propagation logic are: 'emit' or 'broadcast'."),y=!1,p=!1,e(o.eventBroadcast[a.lObjectType].enable)&&h(o.eventBroadcast[a.lObjectType].enable)&&(y=!0),e(o.eventBroadcast[a.lObjectType].disable)&&h(o.eventBroadcast[a.lObjectType].disable)&&(p=!0),y&&p?r.warn(f+"can not enable and disable events at the same time"):y||p?y?o.eventBroadcast[this.lObjectType].enable.forEach(function(n){-1!==v.indexOf(n)?r.warn(f+"This event "+n+" is already enabled"):-1===a.getAvailableEvents().indexOf(n)?r.warn(f+"This event "+n+" does not exist"):v.push(n)}):(v=this.getAvailableEvents(),o.eventBroadcast[a.lObjectType].disable.forEach(function(n){var t=v.indexOf(n);-1===t?r.warn(f+"This event "+n+" does not exist or has been already disabled"):v.splice(t,1)})):r.warn(f+"must enable or disable events")):r.warn(f+"event-broadcast."+[a.lObjectType]+" must be an object check your model."):v=this.getAvailableEvents():r.error(f+"event-broadcast must be an object check your model."):v=this.getAvailableEvents(),v.forEach(function(r){t.on(r,a.genDispatchEvent(n,r,w,o,t,i,u,c,l))}),w},o}]).service("leafletEventsHelpers",["LeafletEventsHelpersFactory",function(n){return new n}]);n.module("leaflet-directive").factory("leafletGeoJsonEvents",["$rootScope","$q","$log","leafletHelpers","LeafletEventsHelpersFactory","leafletData",function(n,t,i,r,u,f){var s=r.safeApply,o=u,e=function(){o.call(this,"leafletDirectiveGeoJson","geojson")};return e.prototype=new o,e.prototype.genDispatchEvent=function(t,i,r,u,e,h,c,l,a){var v=o.prototype.genDispatchEvent.call(this,t,i,r,u,e,h,c,l),y=this;return function(t){"mouseout"===i&&(a.resetStyleOnMouseout&&f.getGeoJSON(a.mapId).then(function(n){var i=l?n[l]:n;i.resetStyle(t.target)}),s(u,function(){n.$broadcast(y.rootBroadcastName+".mouseout",t)}));v(t)}},e.prototype.getAvailableEvents=function(){return["click","dblclick","mouseover","mouseout"]},new e}]);n.module("leaflet-directive").factory("leafletLabelEvents",["$rootScope","$q","$log","leafletHelpers","LeafletEventsHelpersFactory",function(n,t,i,r,u){var o=r,e=u,f=function(){e.call(this,"leafletDirectiveLabel","markers")};return f.prototype=new e,f.prototype.genDispatchEvent=function(n,t,i,r,u,f,o,s){var h=f.replace("markers.","");return e.prototype.genDispatchEvent.call(this,n,t,i,r,u,h,o,s)},f.prototype.getAvailableEvents=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu"]},f.prototype.genEvents=function(n,t,i,r,u,f,e,s){var h=this,c=this.getAvailableEvents(),l=o.getObjectArrayPath("markers."+f);c.forEach(function(t){u.label.on(t,h.genDispatchEvent(n,t,i,r,u.label,l,e,s))})},f.prototype.bindEvents=function(){},new f}]);n.module("leaflet-directive").factory("leafletMapEvents",["$rootScope","$q","$log","leafletHelpers","leafletEventsHelpers","leafletIterators",function(n,t,i,r,u,f){var e=r.isDefined,s=u.fire,h=function(){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomanim","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose","draw:created","draw:edited","draw:deleted","draw:drawstart","draw:drawstop","draw:editstart","draw:editstop","draw:deletestart","draw:deletestop"]},o=function(n,t,r,u){return u&&(u+="."),function(f){var e="leafletDirectiveMap."+u+t;i.debug(e);s(n,e,r,f,f.target,n)}},c=function(n){n.$broadcast("boundsChanged")},l=function(n,t,i,r){if(e(i.urlHashCenter)){var u=t.getCenter(),f=u.lat.toFixed(4)+":"+u.lng.toFixed(4)+":"+t.getZoom();e(r.c)&&r.c===f||n.$emit("centerUrlHash",f)}},a=function(n,t,i,r,u){f.each(t,function(t){var f={};f[i]=t;n.on(t,o(r,t,u,n._container.id||""),f)})};return{getAvailableMapEvents:h,genDispatchMapEvent:o,notifyCenterChangedToBounds:c,notifyCenterUrlHashChanged:l,addEvents:a}}]);n.module("leaflet-directive").factory("leafletMarkerEvents",["$rootScope","$q","$log","leafletHelpers","LeafletEventsHelpersFactory","leafletLabelEvents",function(n,t,i,r,u,f){var s=r.safeApply,h=r.isDefined,c=r,l=f,o=u,e=function(){o.call(this,"leafletDirectiveMarker","markers")};return e.prototype=new o,e.prototype.genDispatchEvent=function(t,i,r,u,f,e,h,c){var l=o.prototype.genDispatchEvent.call(this,t,i,r,u,f,e,h,c);return function(t){"click"===i?s(u,function(){n.$broadcast("leafletDirectiveMarkersClick",e)}):"dragend"===i&&(s(u,function(){h.lat=f.getLatLng().lat;h.lng=f.getLatLng().lng}),h.message&&h.focus===!0&&f.openPopup());l(t)}},e.prototype.getAvailableEvents=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose","touchend","touchstart","touchmove","touchcancel","touchleave"]},e.prototype.bindEvents=function(n,t,i,r,u,f){var e=o.prototype.bindEvents.call(this,n,t,i,r,u,f);c.LabelPlugin.isLoaded()&&h(t.label)&&l.genEvents(n,i,e,u,t,r,f)},new e}]);n.module("leaflet-directive").factory("leafletPathEvents",["$rootScope","$q","$log","leafletHelpers","leafletLabelEvents","leafletEventsHelpers",function(n,t,i,r,u,f){var s=r.isDefined,h=r.isObject,c=r,e=r.errorHeader,l=u,a=f.fire,v=function(n,t,r,u,f,e,o,s){return n=n||"",n&&(n="."+n),function(h){var c="leafletDirectivePath"+n+"."+t;i.debug(c);a(u,c,r,h,h.target||f,o,e,s)}},y=function(n,t,r,u,f){var a,y,p=[],k="broadcast",w,b,d;if(s(f.eventBroadcast))if(h(f.eventBroadcast))if(s(f.eventBroadcast.path))if(h(f.eventBroadcast.paths))i.warn(e+"event-broadcast.path must be an object check your model.");else if(void 0!==f.eventBroadcast.path.logic&&null!==f.eventBroadcast.path.logic&&("emit"!==f.eventBroadcast.path.logic&&"broadcast"!==f.eventBroadcast.path.logic?i.warn(e+"Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===f.eventBroadcast.path.logic&&(k="emit")),w=!1,b=!1,void 0!==f.eventBroadcast.path.enable&&null!==f.eventBroadcast.path.enable&&"object"==typeof f.eventBroadcast.path.enable&&(w=!0),void 0!==f.eventBroadcast.path.disable&&null!==f.eventBroadcast.path.disable&&"object"==typeof f.eventBroadcast.path.disable&&(b=!0),w&&b)i.warn(e+"can not enable and disable events at the same time");else if(w||b)if(w)for(a=0;a<f.eventBroadcast.path.enable.length;a++)y=f.eventBroadcast.path.enable[a],-1!==p.indexOf(y)?i.warn(e+"This event "+y+" is already enabled"):-1===o().indexOf(y)?i.warn(e+"This event "+y+" does not exist"):p.push(y);else for(p=o(),a=0;a<f.eventBroadcast.path.disable.length;a++)y=f.eventBroadcast.path.disable[a],d=p.indexOf(y),-1===d?i.warn(e+"This event "+y+" does not exist or has been already disabled"):p.splice(d,1);else i.warn(e+"must enable or disable events");else p=o();else i.error(e+"event-broadcast must be an object check your model.");else p=o();for(a=0;a<p.length;a++)y=p[a],t.on(y,v(n,y,k,f,p,r));c.LabelPlugin.isLoaded()&&s(t.label)&&l.genEvents(n,r,k,f,t,u)},o=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","add","remove","popupopen","popupclose"]};return{getAvailablePathEvents:o,bindPathEvents:y}}])}(n)})(angular);var L=L||require("leaflet"),_MAX_POINT_INTERVAL_MS=15e3,_SECOND_IN_MILLIS=1e3,_MINUTE_IN_MILLIS=60*_SECOND_IN_MILLIS,_HOUR_IN_MILLIS=60*_MINUTE_IN_MILLIS,_DAY_IN_MILLIS=24*_HOUR_IN_MILLIS,_DEFAULT_MARKER_OPTS={startIconUrl:"pin-icon-start.png",endIconUrl:"pin-icon-end.png",shadowUrl:"pin-shadow.png",wptIconUrls:{"":"pin-icon-wpt.png"},iconSize:[33,50],shadowSize:[50,50],iconAnchor:[16,45],shadowAnchor:[16,47],clickable:!1},_DEFAULT_POLYLINE_OPTS={color:"blue"},_DEFAULT_GPX_OPTS={parseElements:["track","route","waypoint"]};L.GPX=L.FeatureGroup.extend({initialize:function(n,t){t.max_point_interval=t.max_point_interval||_MAX_POINT_INTERVAL_MS;t.marker_options=this._merge_objs(_DEFAULT_MARKER_OPTS,t.marker_options||{});t.polyline_options=this._merge_objs(_DEFAULT_POLYLINE_OPTS,t.polyline_options||{});t.gpx_options=this._merge_objs(_DEFAULT_GPX_OPTS,t.gpx_options||{});L.Util.setOptions(this,t);L.GPXTrackIcon=L.Icon.extend({options:t.marker_options});this._gpx=n;this._layers={};this._info={name:null,length:0,elevation:{gain:0,loss:0,max:0,min:1/0,_points:[]},hr:{avg:0,_total:0,_points:[]},duration:{start:null,end:null,moving:0,total:0}};n&&this._parse(n,t,this.options.async)},get_duration_string:function(n,t){var i="",r,u;return n>=_DAY_IN_MILLIS&&(i+=Math.floor(n/_DAY_IN_MILLIS)+"d ",n%=_DAY_IN_MILLIS),n>=_HOUR_IN_MILLIS&&(i+=Math.floor(n/_HOUR_IN_MILLIS)+":",n%=_HOUR_IN_MILLIS),r=Math.floor(n/_MINUTE_IN_MILLIS),n%=_MINUTE_IN_MILLIS,r<10&&(i+="0"),i+=r+"'",u=Math.floor(n/_SECOND_IN_MILLIS),n%=_SECOND_IN_MILLIS,u<10&&(i+="0"),i+=u,i+(!t&&n>0?"."+Math.round(1e3*Math.floor(n))/1e3:'"')},to_miles:function(n){return n/1.60934},to_ft:function(n){return 3.28084*n},m_to_km:function(n){return n/1e3},m_to_mi:function(n){return n/1609.34},get_name:function(){return this._info.name},get_desc:function(){return this._info.desc},get_author:function(){return this._info.author},get_copyright:function(){return this._info.copyright},get_distance:function(){return this._info.length},get_distance_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))},get_start_time:function(){return this._info.duration.start},get_end_time:function(){return this._info.duration.end},get_moving_time:function(){return this._info.duration.moving},get_total_time:function(){return this._info.duration.total},get_moving_pace:function(){return this.get_moving_time()/this.m_to_km(this.get_distance())},get_moving_pace_imp:function(){return this.get_moving_time()/this.get_distance_imp()},get_moving_speed:function(){return this.m_to_km(this.get_distance())/(this.get_moving_time()/36e5)},get_moving_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_moving_time()/36e5)},get_total_speed:function(){return this.m_to_km(this.get_distance())/(this.get_total_time()/36e5)},get_total_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_total_time()/36e5)},get_elevation_gain:function(){return this._info.elevation.gain},get_elevation_loss:function(){return this._info.elevation.loss},get_elevation_gain_imp:function(){return this.to_ft(this.get_elevation_gain())},get_elevation_loss_imp:function(){return this.to_ft(this.get_elevation_loss())},get_elevation_data:function(){var n=this;return this._info.elevation._points.map(function(t){return n._prepare_data_point(t,n.m_to_km,null,function(n,t){return n.toFixed(2)+" km, "+t.toFixed(0)+" m"})})},get_elevation_data_imp:function(){var n=this;return this._info.elevation._points.map(function(t){return n._prepare_data_point(t,n.m_to_mi,n.to_ft,function(n,t){return n.toFixed(2)+" mi, "+t.toFixed(0)+" ft"})})},get_elevation_max:function(){return this._info.elevation.max},get_elevation_min:function(){return this._info.elevation.min},get_elevation_max_imp:function(){return this.to_ft(this.get_elevation_max())},get_elevation_min_imp:function(){return this.to_ft(this.get_elevation_min())},get_average_hr:function(){return this._info.hr.avg},get_heartrate_data:function(){var n=this;return this._info.hr._points.map(function(t){return n._prepare_data_point(t,n.m_to_km,null,function(n,t){return n.toFixed(2)+" km, "+t.toFixed(0)+" bpm"})})},get_heartrate_data_imp:function(){var n=this;return this._info.hr._points.map(function(t){return n._prepare_data_point(t,n.m_to_mi,null,function(n,t){return n.toFixed(2)+" mi, "+t.toFixed(0)+" bpm"})})},reload:function(){this.clearLayers();this._parse(this._gpx,this.options,this.options.async)},_merge_objs:function(n,t){var r={};for(var i in n)r[i]=n[i];for(i in t)r[i]=t[i];return r},_prepare_data_point:function(n,t,i,r){var u=[t&&t(n[0])||n[0],i&&i(n[1])||n[1]];return u.push(r&&r(u[0],u[1])||u[0]+": "+u[1]),u},_load_xml:function(n,t,i,r){void 0==r&&(r=this.options.async);void 0==i&&(i=this.options);var u=new window.XMLHttpRequest;u.open("GET",n,r);try{u.overrideMimeType("text/xml")}catch(n){}u.onreadystatechange=function(){4==u.readyState&&200==u.status&&t(u.responseXML,i)};u.send(null)},_parse:function(n,t,i){var r=this,u=function(n,t){var i=r._parse_gpx_data(n,t);i&&(r.addLayer(i),r.fire("loaded"))},f;"<"===n.substr(0,1)?(f=new DOMParser,i?setTimeout(function(){u(f.parseFromString(n,"text/xml"),t)}):u(f.parseFromString(n,"text/xml"),t)):this._load_xml(n,u,t,i)},_parse_gpx_data:function(n,t){var c,i,r,u=[],l=[],v=t.gpx_options.parseElements,o,y,p,s,w,h,b,f,k,e,d,a;for(v.indexOf("route")>-1&&l.push(["rte","rtept"]),v.indexOf("track")>-1&&l.push(["trkseg","trkpt"]),o=n.getElementsByTagName("name"),o.length>0&&(this._info.name=o[0].textContent),f=n.getElementsByTagName("desc"),f.length>0&&(this._info.desc=f[0].textContent),y=n.getElementsByTagName("author"),y.length>0&&(this._info.author=y[0].textContent),p=n.getElementsByTagName("copyright"),p.length>0&&(this._info.copyright=p[0].textContent),c=0;c<l.length;c++)for(r=n.getElementsByTagName(l[c][0]),i=0;i<r.length;i++)s=this._parse_trkseg(r[i],n,t,l[c][1]),0!==s.length&&(w=new L.Polyline(s,t.polyline_options),(this.fire("addline",{line:w}),u.push(w),t.marker_options.startIcon||t.marker_options.startIconUrl)&&(h=new L.Marker(s[0],{clickable:t.marker_options.clickable,icon:t.marker_options.startIcon||new L.GPXTrackIcon({iconUrl:t.marker_options.startIconUrl})}),this.fire("addpoint",{point:h,point_type:"start"}),u.push(h)),(t.marker_options.endIcon||t.marker_options.endIconUrl)&&(h=new L.Marker(s[s.length-1],{clickable:t.marker_options.clickable,icon:t.marker_options.endIcon||new L.GPXTrackIcon({iconUrl:t.marker_options.endIconUrl})}),this.fire("addpoint",{point:h,point_type:"end"}),u.push(h)));if(this._info.hr.avg=Math.round(this._info.hr._total/this._info.hr._points.length),v.indexOf("waypoint")>-1)for(r=n.getElementsByTagName("wpt"),i=0;i<r.length;i++){var nt=new L.LatLng(r[i].getAttribute("lat"),r[i].getAttribute("lon")),g=r[i].getElementsByTagName("name"),o="";if(g.length>0&&(o=g[0].textContent),b=r[i].getElementsByTagName("desc"),f="",b.length>0&&(f=b[0].textContent),k=r[i].getElementsByTagName("sym"),e="",k.length>0&&(e=k[0].textContent),t.marker_options.wptIcons&&t.marker_options.wptIcons[e])d=t.marker_options.wptIcons[e];else{if(!t.marker_options.wptIconUrls||!t.marker_options.wptIconUrls[e]){console.log('No icon or icon URL configured for symbol type "'+e+'"; ignoring waypoint.');continue}d=new L.GPXTrackIcon({iconUrl:t.marker_options.wptIconUrls[e]})}a=new L.Marker(nt,{clickable:!0,title:o,icon:d});a.bindPopup("<b>"+o+"<\/b>"+(f.length>0?"<br>"+f:"")).openPopup();this.fire("addpoint",{point:a,point_type:"waypoint"});u.push(a)}return u.length>1?new L.FeatureGroup(u):1==u.length?u[0]:void 0},_parse_trkseg:function(n,t,i,r){var o=n.getElementsByTagName(r),f,u,e;if(!o.length)return[];for(var c=[],h=null,s=0;s<o.length;s++)u=new L.LatLng(o[s].getAttribute("lat"),o[s].getAttribute("lon")),(u.meta={time:null,ele:null,hr:null},f=o[s].getElementsByTagName("time"),f.length>0&&(u.meta.time=new Date(Date.parse(f[0].textContent))),f=o[s].getElementsByTagName("ele"),f.length>0&&(u.meta.ele=parseFloat(f[0].textContent)),f=o[s].getElementsByTagNameNS("*","hr"),f.length>0&&(u.meta.hr=parseInt(f[0].textContent),this._info.hr._points.push([this._info.length,u.meta.hr]),this._info.hr._total+=u.meta.hr),u.meta.ele>this._info.elevation.max&&(this._info.elevation.max=u.meta.ele),u.meta.ele<this._info.elevation.min&&(this._info.elevation.min=u.meta.ele),this._info.elevation._points.push([this._info.length,u.meta.ele]),this._info.duration.end=u.meta.time,null!=h)?(this._info.length+=this._dist3d(h,u),e=u.meta.ele-h.meta.ele,e>0?this._info.elevation.gain+=e:this._info.elevation.loss+=Math.abs(e),e=Math.abs(u.meta.time-h.meta.time),this._info.duration.total+=e,e<i.max_point_interval&&(this._info.duration.moving+=e)):this._info.duration.start=u.meta.time,h=u,c.push(u);return c},_dist2d:function(n,t){var i=this._deg2rad(t.lat-n.lat),r=this._deg2rad(t.lng-n.lng),u=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this._deg2rad(n.lat))*Math.cos(this._deg2rad(t.lat))*Math.sin(r/2)*Math.sin(r/2),f=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return 6371e3*f},_dist3d:function(n,t){var i=this._dist2d(n,t),r=Math.abs(t.meta.ele-n.meta.ele);return Math.sqrt(Math.pow(i,2)+Math.pow(r,2))},_deg2rad:function(n){return n*Math.PI/180}});"object"==typeof module&&"object"==typeof module.exports?module.exports=L:"function"==typeof define&&define.amd&&define(L);